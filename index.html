<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta name="google-site-verification" content="ZWidhp29xotLZ2B8B4mHHEtWvixWj6HhA9Uaav06BYA" />
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N3QQWX28');</script>
<meta charset="UTF-8">
  <meta name="google-adsense-account" content="ca-pub-1607055557776596">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
        <title>Nothing Space - Built Together</title>
    <meta name="description" content="Nothing Space is an all-in-one platform for Nothing users with service centre info, wallpapers, ringtones, tools, firmware, OTA ZIP updates, camera presets, and community projects.">
    <meta name="author" content="Nothing Space"> 
    <link rel="canonical" href="https://nothingtools.github.io/" />
    <link rel="icon" type="image/svg+xml" href="./icon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">  
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
  <link rel="preconnect" href="https://nothingcommunity-7664f-default-rtdb.firebaseio.com">
  
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>

<style>
  /* ================= 1. ROOT & THEME ================= */
:root { --bg: #000; --card: #0c0c0c; --text: #fff; --dot-bg: #222; --border: #1a1a1a; --instr: #bbb; --accent: #ff0000; --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1); color-scheme: light dark; }
[data-theme="light"] { --bg: #fff; --card: #f5f5f5; --text: #000; --dot-bg: #ddd; --border: #eee; --instr: #333; }
[data-theme="dark"] { --bg: #000; --card: #0c0c0c; --text: #fff; --dot-bg: #333; --border: #1a1a1a; --instr: #bbb; }

/* ================= 2. GLOBAL RESET ================= */
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { background: var(--bg); color: var(--text); font-family: 'VT323', monoSpace; transition: background var(--transition); width: 100%; overflow-x: hidden; min-height: 100vh; overscroll-behavior-y: none; }
h1, h2, h3, span, button, select, input, p, textarea { font-family: 'VT323', monoSpace !important; text-transform: uppercase; }
img { -webkit-touch-callout: none !important; user-select: none !important; pointer-events: auto !important; } 
.bento, footer { content-visibility: auto; contain-intrinsic-size: 1000px; }

/* ================= 3. BACKGROUND ANIMATIONS ================= */
.stars-container { position: fixed; inset: 0; z-index: -1; background: var(--bg); overflow: hidden; pointer-events: none; }
.star { position: absolute; background: var(--text); border-radius: 50%; opacity: 0; will-change: opacity; }
.canvas { position: fixed; inset: 0; background-image: radial-gradient(var(--dot-bg) 1.2px, transparent 1.2px); background-size: 32px 32px; z-index: -1; opacity: 0.5; pointer-events: none; }
.moon { position: fixed; width: 80px; height: 80px; top: 10%; left: 10%; background: #d1d1d1; border-radius: 50%; z-index: -1; opacity: 0.5; box-shadow: inset -15px -15px 30px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.2); }

/* ================= 4. HEADER & NAV ================= */
header { max-width: 1000px; margin: 30px auto 20px; padding: 0 20px; display: flex; flex-direction: column; gap: 20px; position: relative; z-index: 10; }
.header-top { width: 100%; display: flex; justify-content: space-between; align-items: center; }
.logo h1 { font-size: 3.5rem; letter-spacing: -1px; line-height: 0.9; }
.logo p { opacity: 0.8 !important; letter-spacing: 2px; }
.t-toggle { width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--border); display: grid; place-items: center; cursor: pointer; background: var(--card); transition: var(--transition); }
.t-toggle:hover { border-color: var(--text); }
#t-icon { color: var(--text) !important; transition: transform .3s ease; }
.t-toggle:active #t-icon { transform: rotate(150deg) scale(1.1); }

/* ================= 5. BENTO GRID ================= */
.bento { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 1000px; margin: 0 auto; padding: 20px; overflow: visible; position: relative; z-index: 10; }
@media (min-width: 768px) { .bento { grid-template-columns: repeat(3, 1fr); } }
.tile { background: var(--card); border: 1px solid var(--border); border-radius: 35px; padding: 25px; cursor: pointer; transition: var(--transition); opacity: 1; transform: none; position: relative; overflow: hidden; }
.tile:hover { border-color: #333; transform: translateY(-2px); }
.tile:active { transform: scale(0.95); }
.tile h2 { font-size: 2.2rem; position: relative; z-index: 2; }
.tile p { opacity: 0.8 !important; font-size: 1rem; position: relative; z-index: 2; }
.full { grid-column: span 2; }
@media (min-width: 768px) { .full { grid-column: span 1; } }

/* ================= 6. MODALS & POPUPS ================= */
.screen { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(15px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
.screen.active { display: flex !important; opacity: 1; }
.modal { background: var(--bg); border: 1px solid var(--border); width: 90%; max-width: 500px; max-height: 90dvh; border-radius: 35px; padding: 30px; position: relative; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); opacity: 0; transform: scale(0.7) translateY(50px); transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease; will-change: transform, opacity; display: flex; flex-direction: column; }
.modal > div { flex-shrink: 0 !important; }
.screen.active .modal { opacity: 1; transform: scale(1) translateY(0); }
.close-icon { position: absolute; right: 25px; top: 25px; font-size: 2.2rem; cursor: pointer; opacity: 0.5; transition: 0.2s; z-index: 10; background: transparent; border: none; color: var(--text); }
.close-icon:hover { opacity: 1; color: var(--text); }
.modal h2 { margin-bottom: 20px !important; margin-top: 5px !important; line-height: 1; }

/* ================= 7. INPUTS & BUTTONS ================= */
.input-group { position: relative; width: 100%; margin-bottom: 12px; display: flex; align-items: center; }
select, input, textarea { width: 100%; padding: 20px; background: var(--card); border: 1px solid var(--border); color: var(--text); border-radius: 22px; font-size: 1.6rem; outline: none; appearance: none; }
textarea { font-size: 1.2rem; resize: none; }
.arrow-wrapper { position: absolute; right: 25px; pointer-events: none; color: var(--text); }
.btn { position: relative; width: 100%; padding: 18px; border-radius: 22px; border: none; background: var(--text); color: var(--bg); font-size: 1.5rem; cursor: pointer; font-weight: bold; margin-top: 5px; overflow: hidden; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
.progress-bar { position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: rgba(128,128,128,0.5); z-index: 1; }
.btn-text { position: relative; z-index: 2; }
.btn:active { transform: scale(0.98); }
.pg-btn:active { transform: scale(0.98); }
.pg-btn { width: 100%; padding: 20px 30px; border-radius: 22px; background: var(--card); border: 1px solid var(--border); color: var(--text); font-size: 1.2rem; letter-spacing: 1px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 15px; font-weight: thin; transition: 0.2s; text-transform: uppercase; }
.pg-btn:hover { border-color: var(--text); }
.dot-arrow { width: 20px; height: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1px; }
.dot-row { display: flex; gap: 2px; }
.dot { width: 2.5px; height: 2.5px; background: var(--text); border-radius: 50%; } 

/* ================= 8. COMMUNITY PROJECTS ================= */
.project-card { background: var(--card); border: 1px solid var(--border); border-radius: 30px; padding: 20px; margin-bottom: 25px; }
.p-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
.p-avatar { width: 55px; height: 55px; border-radius: 50%; object-fit: cover; border: 1px solid var(--border); }
.p-info h3 { margin: 0; font-size: 1.4rem; line-height: 1; display: flex; align-items: center; gap: 5px; }
.p-info span { font-size: 0.9rem; opacity: 0.6; }
.blue-tick { color: #3b82f6; font-size: 1rem; }
.p-imgs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 15px 0; }
.p-imgs img { width: 100%; height: 80px; object-fit: cover; border-radius: 12px; border: 1px solid #333; cursor: pointer; }
.p-link-btn { display: block; width: 100%; padding: 12px; text-align: center; border: 1px solid var(--accent); color: var(--text); border-radius: 15px; text-decoration: none; font-weight: bold; font-size: 1rem; margin-top: 10px; }
.p-link-btn:hover { background: var(--accent); color: #fff; }
.pfp-select { width: 80px; height: 80px; border-radius: 50%; border: 1px dashed var(--text); display: grid; place-items: center; cursor: pointer; margin: 0 auto 20px; overflow: hidden; } 

/* ================= 9. SETUP & 3D SCROLL ================= */
.setup-grid-container { padding-top: 20px; padding-bottom: 30px; }
.setup-card { background: var(--card); border: 1px solid var(--border); border-radius: 30px; padding: 25px; margin-bottom: 0px; transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s ease, filter 0.4s ease; transform: scale(0.85); opacity: 0.4; filter: blur(2px); transform-origin: center center; }
.setup-card.in-focus { transform: scale(1); opacity: 1; filter: blur(0px); z-index: 10; }
.setup-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
.phone-showcase { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
.phone-frame { width: 48%; aspect-ratio: 9/19; background: #000; border-radius: 18px; border: 2px solid #333; overflow: hidden; cursor: pointer; transition: 0.2s; }
.phone-frame.active { border-color: var(--accent); transform: scale(1.02); }
.phone-frame img { width: 100%; height: 100%; }
.dl-btn { width: 100%; background: var(--text); color: var(--bg); border: none; padding: 12px; border-radius: 12px; font-weight: bold; display: none; margin-top: 10px; cursor: pointer; }
.upload-box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 20px; }
.upload-area:active { transform: scale(0.99); }
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
.upload-area { border: 1px dashed #444; border-radius: 12px; height: 100px; display: grid; place-items: center; cursor: pointer; color: #666; background: rgba(255,255,255,0.02); overflow: hidden; }
.upload-area img { width: 100%; height: 100%; object-fit: contain; }
.like-btn { background: transparent; border: 1px solid #333; color: var(--text); padding: 8px 16px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size:1.1rem;}
.like-btn:active { transform: scale(0.95); }
.like-btn.liked { background: var(--accent); border-color: var(--accent); color: white; }

/* ================= 10. SELECTORS UI ================= */
.selector-list { display: flex; flex-direction: column; max-height: 60vh; overflow-y: auto; gap:8px; }
.selector-item { padding: 20px; background: var(--card); border: 1px solid var(--border); border-radius: 22px; cursor: pointer; font-size: 1.4rem; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
.selector-item:hover { border-color: var(--text); }
.selector-item:active { transform: scale(0.95); }
.custom-select-trigger { width: 100%; padding: 20px; background: var(--card); border: 1px solid var(--border); color: var(--text); border-radius: 22px; font-size: 1.6rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; } 

/* ================= 11. CHAT & MESSAGING ================= */
.red-dot-loader { width: 10px; height: 10px; background-color: #ff0000; border-radius: 50%; display: inline-block; box-shadow: 0 0 8px #ff0000; animation: pulse-red 0.8s ease-in-out infinite; }
@keyframes pulse-red { 0% { transform: scale(0.8); opacity: 0.6; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(0.8); opacity: 0.6; } }
.msg-bubble { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 12px 15px; border-radius: 20px; position: relative; max-width: 85%; align-self: flex-start; margin-bottom: 10px; display: flex; flex-direction: column; cursor: pointer; transition: background 0.2s; }
.msg-bubble:active { background: rgba(255,255,255,0.08); }
.msg-bubble.self { align-self: flex-end; background: rgba(255, 255, 255, 0.1); border-color: var(--text); text-align: right; }
.msg-bubble.self .u-badge { align-self: flex-end; }
.u-badge { font-size: 0.7rem; background: var(--text); color: var(--bg); padding: 2px 8px; border-radius: 5px; margin-bottom: 5px; display: inline-block; align-self: flex-start; cursor: pointer; }
.u-badge:active { transform: scale(0.95); }
.admin-reply-box { margin-top: 10px; padding: 8px 12px; background: rgba(255, 0, 0, 0.05); border-left: 2px solid var(--accent); border-radius: 10px; font-size: 0.9rem; }
.admin-tag { color: var(--accent); font-weight: bold; font-size: 0.7rem; display: block; margin-bottom: 2px; }
.msg-img { max-width: 100%; border-radius: 12px; margin-top: 5px; margin-bottom: 5px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; }
#imgPreview { display: none; width: 40px; height: 40px; object-fit: cover; border-radius: 8px; margin-right: 10px; border: 1px solid var(--accent); cursor: pointer; }
#replyBanner { background: var(--card); border-bottom: 1px solid var(--border); padding: 10px 15px; display: none; align-items: center; justify-content: space-between; gap: 15px; font-size: 0.9rem; animation: slideUp 0.2s ease; color: var(--text); max-width: 100%; }
.reply-info { display: flex; flex-direction: column; flex: 1; overflow: hidden; min-width: 0; }
#replyText { opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; width: 100%; }
.close-reply-btn { background: none; border: none; color: var(--text); cursor: pointer; font-size: 1.5rem; flex-shrink: 0; padding: 0 5px; }
@keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.quoted-block { background: rgba(127, 127, 127, 0.15); border-left: 3px solid var(--text); padding: 6px 10px; border-radius: 6px; margin-bottom: 8px; font-size: 0.85rem; display: flex; flex-direction: column; cursor: pointer; text-align: left; }
.q-name { font-weight: bold; font-size: 0.75rem; opacity: 0.9; margin-bottom: 2px; }
.q-text { opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.msg-footer { display: none; justify-content: flex-end; align-items: center; gap: 15px; margin-top: 6px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 5px; animation: fadeIn 0.2s ease; }
.msg-bubble.active-actions .msg-footer { display: flex; }
.action-btn { font-size: 0.8rem; opacity: 0.6; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 5px; padding: 2px 5px; }
.action-btn:hover { opacity: 1; color: var(--accent); }
.del-btn:hover { color: #ff4444; }

/* ================= 12. IMAGE VIEWER ================= */
#imgViewer { position: fixed; inset: 0; z-index: 5000; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; }
#imgViewer.active { opacity: 1; }
#viewImg { max-width: 95%; max-height: 80%; border-radius: 10px; box-shadow: 0 0 20px rgba(255,0,0,0.2); }
.viewer-ctrls { position: absolute; bottom: 30px; display: flex; gap: 20px; }
.v-btn { background: #333; color: #fff; border: 1px solid #555; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; gap: 8px; } 

/* ================= 13. PRODUCTS & HARDWARE ================= */
.hw-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-bottom: 20px; }
.hw-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; text-align: center; cursor: pointer; transition: 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: space-between; min-height: 160px; }
.hw-card:active { transform: scale(0.96); border-color: var(--text); }
.hw-card img { width: 100%; height: 90px; object-fit: contain; margin-bottom: 10px; pointer-events: none; }
.filter-card { background: var(--card); border: 1px solid var(--border); border-radius: 25px; padding: 10px; margin-bottom: 25px; box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }
.cat-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
.hw-pill { border: 1px solid var(--border); color: var(--text); padding: 8px 18px; border-radius: 50px; opacity: 1; cursor: pointer; white-space: nowrap; background: var(--card); transition: 0.2s; font-family: 'VT323'; font-size: 1.1rem; }
.hw-pill.active { background: var(--text); color: var(--bg); opacity: 1; font-weight: bold; border-color: var(--text); }
.img-box { position: relative; height: 350px; background: var(--card); border-radius: 25px; margin-top: 20px; border: 1px solid var(--border); overflow: hidden; display: flex; align-items: center; justify-content: center; }
.slider { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 100%; width: 100%; scrollbar-width: none; scroll-behavior: smooth; }
.slide { flex: 0 0 100%; scroll-snap-align: center; display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; }
.slide img { max-width: 85%; max-height: 85%; object-fit: contain; pointer-events: none; border-radius: 20px;}
.img-badge { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.5); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; color: #fff; border: 1px solid rgba(255,255,255,0.1); pointer-events: none; backdrop-filter: blur(5px); }
.hint-text { position: absolute; bottom: 15px; width: 100%; text-align: center; font-size: 0.9rem; opacity: 0.5; pointer-events: none; }
.nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 50%; background: var(--bg); color: var(--text); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; z-index: 20; opacity: 0.8; }
.nav-arrow:active { transform: translateY(-50%) scale(0.9); }
.prev { left: 15px; } .next { right: 15px; }
.color-dot { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; position: relative; }
.color-dot.active { transform: scale(1.2); border: 2px solid var(--text); }
.p-title { font-size: 2rem; line-height: 1; margin-top: 10px; }
.specs-table { background: var(--card); border-radius: 20px; padding: 15px; border: 1px solid var(--border); }
.row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed var(--border); font-size: 1.1rem; }
.row:last-child { border: none; }
.row span:first-child { opacity: 0.6; }
.buy-btn { width: 100%; background: var(--card); color: var(--text); border: 1px solid var(--border); padding: 16px; border-radius: 50px; font-size: 1.4rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; gap: 10px; align-items: center; text-decoration: none; margin-top: 20px; box-shadow: var(--border); transition: 0.2s; }
.buy-btn:active { transform: scale(0.98); box-shadow: none; }
.layer-3d { position: absolute; inset: 0; background: var(--card); z-index: 50; display: none; animation: fadeIn 0.3s; }
.close-3d { position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: var(--bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 60; cursor: pointer; border: 1px solid var(--border); }
.bar { position: absolute; bottom: 0; left: 0; height: 3px; background: var(--text); width: 0%; transition: width 0.1s; z-index: 60; }
.loading .bar { width: 100%; transition: width 0.7s linear; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ================= 14. MUSIC UI ================= */
.music-ui { text-align: center; }
.search-box-m { display: flex; background: var(--card) !important; padding: 5px 10px; border-radius: 50px !important; border: 1px solid var(--border); margin-bottom: 20px; align-items: center; }
.search-box-m input { flex: 1; background: transparent !important; border: none !important; color: var(--text) !important; padding: 12px; font-size: 1.2rem; outline: none; }
.go-btn { width: 40px !important; height: 40px !important; border-radius: 50% !important; border: none; background: #000 !important; color: var(--text) !important; cursor: pointer; display: flex; align-items: center; justify-content: center; }
#music-card { display: none; margin-top: 20px; background: var(--card); border: 1px solid var(--border); border-radius: 30px; padding: 20px; text-align: center; }
.disc { width: 140px; height: 140px; border-radius: 50%; border: 2px solid var(--border); margin: 0 auto 15px auto; object-fit: cover; display: block; }
.spinning { animation: rotate 10s linear infinite; }
@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.m-ctrls { display: flex; justify-content: center; align-items: center; gap: 30px; font-size: 1.8rem; margin: 20px 0; }
#mini-player { position: absolute; top: 65px; right: 90px; width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--accent); overflow: hidden; cursor: pointer; display: none; z-index: 10; background: #000; }
#mini-art { width: 100%; height: 100%; object-fit: cover; display: block; }

/* ================= 15. WALLPAPERS ================= */
.wp-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
.wp-card { height: 250px; background: #111; border-radius: 25px; position: relative; overflow: hidden; border: 1px solid var(--border); opacity: 1; transform: translateY(0); transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
.wp-card.hidden-state { opacity: 0; transform: translateY(50px) scale(0.95); }
.wp-card.scroll-active { opacity: 1; transform: translateY(0) scale(1); }
.wp-card img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; display: block; }
.wp-overlay { position: absolute; bottom: 0; width: 100%; padding: 10px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); text-align: center; }
.wp-overlay p { color: #fff !important; opacity: 1 !important; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
.wp-overlay .btn { width: 90%; margin: 5px auto 0; padding: 8px 0; font-size: 1rem; border-radius: 15px; background: #fff !important; }
.wp-overlay .btn .btn-text { color: #000 !important; font-weight: bold !important; opacity: 1 !important; }

/* ================= 16. NOTHING SPACE THEME ================= */
.dotted-bg { background: var(--card) 1px, transparent 1px); background-size: 12px 12px; }
.controls { display: flex; gap: 10px; margin: 0 auto 20px; }
.tab-btn { flex: 1; padding: 14px; width:220px;border-radius: 20px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; font-family: 'VT323', monospace; font-size: 1.2rem; transition: 0.2s; }
.tab-btn:active { transform: scale(0.97); background:var(--border); }

/* ================= 17. DYNAMIC PREVIEW CARD ================= */
.preview-container { max-width: 100%; margin: 0 auto; display: none; animation: fadeIn 0.4s ease; }
.nothing-card { width: 100%; border-radius: 30px; border: 2px solid var(--border); padding: 10px; position: relative;  display: flex; flex-direction: column;background-color: var(--card); }
.img-wrapper { width: 100%; border-radius: 30px; overflow: hidden; background: #111; transition: aspect-ratio 0.4s ease; }
.mode-mobile .img-wrapper { aspect-ratio: 9 / 16; }
.mode-desktop .img-wrapper { aspect-ratio: 16 / 9; }
.img-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; user-select: none; -webkit-user-drag: none; pointer-events: none; }
.img-wrapper img.blur { filter: blur(20px); transform: scale(1.1); }
.card-footer { margin-top: 20px; display: flex; justify-content: space-between; align-items: center; padding: 0 10px; color: var(--text); }
.action-btns { display: flex; gap: 12px; align-items: center; }
.save-pill { background: var(--border); color: var(--text); border: none; padding: 8px 30px; border-radius: 50px; font-family: 'VT323', monospace; font-size: 1.4rem; cursor: pointer; font-weight: bold; transition: 0.2s; }
.save-pill:active { transform: scale(0.95); }
.next-pill { background: var(--border); color: var(--text); border: none; padding: 8px 30px; border-radius: 50px; font-family: 'VT323', monospace; font-size: 1.4rem; cursor: pointer; font-weight: bold; transition: 0.2s; }
.next-pill:active { transform: scale(0.95); }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* ================= 18. FOOTER & OTHER ================= */
.up-box { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 12px; }
.up-box h4 { font-size: 1.4rem; color: var(--text) !important; }
.up-box p { font-size: 0.9rem; opacity: 0.8 !important; margin-top: 4px; text-transform: none; }
.sw-display { display: none; align-items: center; gap: 15px; margin: 0 0 12px; padding: 15px; background: var(--card); border-radius: 25px; border: 1px solid var(--border); animation: fadeIn 0.3s ease; }
.sw-img-box { width: 70px; height: 90px; border-radius: 12px; overflow: hidden; background: var(--card); flex-shrink: 0; }
.sw-img-box img { width: 120%; height: 100%; object-fit: cover; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.guide-box { border: 1px solid var(--border); border-radius: 22px; margin-bottom: 12px; overflow: hidden; margin-top: 0px; background: var(--card); }
.guide-header { padding: 18px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
.guide-content { max-height: 0; overflow: hidden; transition: 0.4s ease; padding: 0 18px; opacity: 0; }
.guide-content.open { max-height: 800px !important; padding: 18px; opacity: 1; border-top: 1px solid var(--border); }
.guide-content p { color: var(--text) !important; opacity: 0.8 !important; text-transform: none; font-size: 1.1rem; margin-bottom: 12px; }
.detail-card { background: var(--card); border: 1px solid var(--border); border-radius: 30px; padding: 25px; margin-top: 2px; animation: fadeIn 0.3s ease; }
.sc-badge { background: #222; color: #888; padding: 4px 10px; border-radius: 8px; font-size: 0.9rem; border: 1px solid var(--border); }
.card-row { display: flex; gap: 10px; margin-top: 15px; }
footer { text-align: center; padding: 5px 30px; opacity: 1 !important; font-size: 0.8rem; letter-spacing: 1px; margin-top: 10px; position: relative; z-index: 10; }
.footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; flex-wrap: wrap; }
footer a { color: var(--text); }
footer p { opacity: 0.8 !important; }
#aiSection { display: none; background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 25px; margin-bottom: 20px; animation: fadeIn 0.3s ease; }

/* ================= FILE DROP ENHANCED UI & ANIMATIONS ================= */
.radar-box { position: relative; width: 60px; height: 60px; margin: 10px auto; display: flex; align-items: center; justify-content: center; }
.radar-core { width: 15px; height: 15px; background: var(--text); border-radius: 50%; z-index: 2; }
.radar-pulse { position: absolute; inset: 0; border: 2px solid var(--text); border-radius: 50%; animation: radar 1.2s infinite ease-out; }
@keyframes radar { 0% { transform: scale(0.2); opacity: 1; } 100% { transform: scale(1.2); opacity: 0; } }
.transfer-bar { width: 100%; max-width: 250px; height: 6px; background: var(--border); border-radius: 10px; overflow: hidden; position: relative; margin: 15px auto; }
.transfer-flow { position: absolute; left: -50%; width: 50%; height: 100%; background: var(--text); animation: dataFlow 0.8s linear infinite; }
@keyframes dataFlow { 0% { left: -50%; } 100% { left: 100%; } }

/* Scanner Video feed clean up */
#dropReader { width: 100%; border-radius: 25px; overflow: hidden; display: none; background: #050505; box-shadow: inset 0 0 20px rgba(0,0,0,0.8); border: 2px solid var(--border); }
#dropReader video { width: 100% !important; object-fit: cover; border-radius: 25px; transform: scale(1.05); }

/* Unified Input Box for Desktop */
.desktop-input-group { position: relative; display: flex; align-items: center; width: 100%; max-width: 350px; margin: 0 auto; }
.desktop-input-group input { width: 100%; padding: 18px 65px 18px 25px; border-radius: 50px; text-align: center; letter-spacing: 4px; font-size: 1.2rem; font-weight: bold; background: var(--card); border: 2px solid var(--border); transition: 0.3s; color: var(--text); outline: none; }
.desktop-input-group input:focus { border-color: var(--text); }
.desktop-input-group .inside-btn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 42px; height: 42px; border-radius: 50%; background: var(--text); color: var(--bg); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.2s; }
.desktop-input-group .inside-btn:active { transform: translateY(-50%) scale(0.85); }

/* Hide on mobile, show on desktop */
.desktop-only { display: none; }
@media (min-width: 768px) {
    .desktop-only { display: block; }
}
/* ================= DROP UI EXTRA FIXES ================= */
.status-pill { background:var(--card); border: 1px solid var(--border); color:var(--text); padding:8px 16px; border-radius:50px; font-size:0.9rem; font-weight:bold; display:inline-flex; align-items:center; gap:8px; }
.disconnect-btn-inline { background: rgba(255,0,0,0.1); color:#ff4444; border:1px solid #ff4444; width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1.1rem; transition:0.2s; }
.disconnect-btn-inline:active { transform: scale(0.9); }
.text-drop-area { width: 100%; background: rgba(255,255,255,0.02); border: 1px dashed var(--border); border-radius: 18px; padding: 15px; color: var(--text); font-family: 'VT323', monospace; font-size: 1.1rem; resize: none; margin-bottom: 10px; outline: none; transition: 0.3s; }
.text-drop-area:focus { border-color: var(--text); background: rgba(255,255,255,0.05); }

/* Animated File Drop Zone */
.animated-drop-zone { border: 2px dashed var(--border); border-radius: 25px; height: 140px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,255,255,0.02); cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
.animated-drop-zone:hover { border-color: var(--text); background: rgba(255,255,255,0.05); transform: translateY(-2px); }
.animated-drop-zone:active { transform: scale(0.97); }
.animated-drop-zone i { font-size: 2.5rem; transition: transform 0.3s ease; margin-bottom: 10px; opacity: 0.8; }
.animated-drop-zone:hover i { transform: translateY(-5px) scale(1.1); color: var(--text); opacity: 1; }
.drop-zone-bg-anim { position: absolute; width: 100px; height: 100px; background: var(--text); filter: blur(50px); opacity: 0; transition: 0.5s; border-radius: 50%; z-index: 0; pointer-events: none; }
.animated-drop-zone:hover .drop-zone-bg-anim { opacity: 0.15; }
.drop-zone-content { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; }</style>
</head>
<body>
 <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N3QQWX28"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="stars-container" id="starField"></div>
  <div class="canvas"></div>

  <header>   
    <div class="header-top">
      <div class="logo" onclick="openScreen('dropScr')" style="cursor: pointer;" title="Secret File Drop">
        <p style="opacity: 0.4; letter-spacing: 2px;">ONLY FOR FANS</p>
        <h1>Nothing<br>Space</h1>
      </div>
      <button class="t-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode">
        <i class="fa-solid fa-sun" id="t-icon"></i>
      </button>
    </div>
  </header>

  <div class="bento">
    <div class="tile full" onclick="openScreen('upScr')"><h1>WEBSITE</h1><p>WHAT'S NEW ADDED</p></div>
          <div class="tile full" onclick="openScreen('musicScr')"><h1>RINGTONE</h1><p>Preview Your Song</p></div>
    <div class="tile full" onclick="openScreen('setupScr')"><h1>LAYOUTS</h1><p>RANK & SHARE BUILDS</p></div>
    <div class="tile full" onclick="openScreen('pgScr')"><h1>PLAYGROUND</h1><p>presets projects</p></div>
    <div class="tile full" onclick="openScreen('swScr')"><h1>FIRMWARE</h1><p>NOS ZIP FILE</p></div>
    <div class="tile full" onclick="openScreen('wpScr')"><h1>GALLERY</h1><p>EXCLUSIVe Collection</p></div>
    <div class="tile full" onclick="openScreen('scScr')"><h1>SUPPORT</h1><p>LOCATE CENTERS</p></div>
    <div class="tile full" onclick="openScreen('feedbackScr')"><h1>COMMUNITY</h1><p>FEEDBACK & SUGGESTIONS</p></div>
  </div>

<div id="hwScr" class="screen">
        <div class="modal">
            <div class="m-head">
                <h2>PRODUCTS</h2>
                 <button class="close-icon" onclick="closeScreen('hwScr')">×</button>
        </div>
            <div class="m-body">
                <div class="cat-scroll">
                    <div class="hw-pill active" onclick="filterHW('all', this)">ALL</div>
                    <div class="hw-pill" onclick="filterHW('phone', this)">PHONES</div>
                    <div class="hw-pill" onclick="filterHW('buds', this)">AUDIO</div>
                    <div class="hw-pill" onclick="filterHW('watch', this)">WATCH</div>
                    <div class="hw-pill" onclick="filterHW('accessories', this)">ACCESSORIES</div>
                </div>
                <div class="hw-grid" id="hwGrid"></div>
            </div>
        </div>
    </div>

    <div id="hwDetailScr" class="screen">
        <div class="modal" >
            <div class="m-head">
                <button class="close-icon" onclick="closeScreen('hwDetailScr')">×</button>
      </div>
                    
            <div class="m-head" ><div style="opacity:0.6;">DETAILS</div>
              <div class="img-box" id="vBox">
                    <div class="bar"></div>
                  
                    <div class="img-badge" id="imgBadge">1/1</div>
                    
                    <div class="nav-arrow prev" id="btnPrev" onclick="slide(-1)">pre</div>
                    <div class="nav-arrow next" id="btnNext" onclick="slide(1)">next</div>

                          <div class="slider" id="sliderTrack"></div>
              <div class="hint-text">HOLD FOR 3D VIEW</div>

                    <div class="layer-3d" id="l3d">
                        <div class="close-3d" onclick="exit3d()">×</div>
                        <model-viewer id="mv" camera-controls auto-rotate shadow-intensity="1" style="width:90%; height:90%;" touch-action="pan-y"></model-viewer>
                    </div>
                </div>

                           <h4 id="dTitle" class="p-title">DEVICE NAME</h4>
    
          <div id="colorPicker" style="display:flex; margin-top:10px;align-items:center;"></div>

                <div class="specs-table" id="dSpecs"></div>
                
                <a id="buyLink" href="#" target="_blank" class="buy-btn" onclick="vibrate(30)">
                    <span>BUY NOW</span>
                </a>
                <div style="height: 30px;"></div>
            </div>
        </div>
    </div>

  <div id="mini-player" onclick="restorePlayer()">
    <img src="" id="mini-art" class="spinning" alt="Mini Player Art">
  </div>

  <div id="imgViewer" onclick="closeImageViewer()">
    <button style="position:absolute; top:20px; right:20px; background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">×</button>
    <img id="viewImg" src="" onclick="event.stopPropagation()">
    <div class="viewer-ctrls" onclick="event.stopPropagation()">
      <button class="v-btn" onclick="downloadViewImage()"><i class="fa-solid fa-download"></i> SAVE</button>
      <button class="v-btn" onclick="closeImageViewer()"><i class="fa-solid fa-xmark"></i> CLOSE</button>
    </div>
  </div>

  <div id="selectorScr" class="screen" style="z-index: 3000;">
    <div class="modal">
      <button class="close-icon" onclick="closeScreen('selectorScr')">×</button>
      <h2 id="selectorTitle">SELECT OPTION</h2>
      <div id="selectorList" class="selector-list" style="margin-top: 20px;"></div>
    </div>
  </div>

  <div id="setupScr" class="screen">
    <div class="modal">
        <button class="close-icon" onclick="closeScreen('setupScr')">×</button>
        <h2 style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px;">TOP SETUPS</h2>
        
        <button class="pg-btn" onclick="toggleUpload()">
            <span>UPLOAD YOUR SETUP</span>
            <i class="fa-solid fa-plus"></i>
        </button>

        <div id="setupUploadForm" class="upload-box" style="display:none;">
            <span style="display:block;color:var(--accent);margin-bottom:5px;">1. SCREENSHOTS (DISPLAY)</span>
            <div class="upload-grid">
                <div class="upload-area" onclick="document.getElementById('ssLockIn').click()"><div id="prevSsLock">HOME SS</div></div>
                <div class="upload-area" onclick="document.getElementById('ssHomeIn').click()"><div id="prevSsHome">LOCK SS</div></div>
            </div>
          
            <span style="display:block;color:var(--accent);margin-bottom:5px;">2. WALLPAPERS (DOWNLOAD)</span>
            <div class="upload-grid">
                <div class="upload-area" onclick="document.getElementById('wallLockIn').click()"><div id="prevWallLock">HOME WP</div></div>
                <div class="upload-area" onclick="document.getElementById('wallHomeIn').click()"><div id="prevWallHome">LOCK WP</div></div>
            </div>

            <input type="file" id="ssLockIn" accept="image/*" hidden onchange="handleImg(this, 'prevSsLock', true)">
            <input type="file" id="ssHomeIn" accept="image/*" hidden onchange="handleImg(this, 'prevSsHome', true)">
            <input type="file" id="wallLockIn" accept="image/*" hidden onchange="handleImg(this, 'prevWallLock', false)">
            <input type="file" id="wallHomeIn" accept="image/*" hidden onchange="handleImg(this, 'prevWallHome', false)">
            
            <input type="text" id="setupTitle" placeholder="SETUP TITLE" maxlength="15" style="margin-bottom: 10px;">
            <textarea id="setupDesc" placeholder="DETAILS (Like- Widgets, Icon Pack ,)" rows="2"></textarea>
            <button class="btn" onclick="submitSetup()" id="submitBtn">POST NOW</button>
        </div>

        <div id="setupGrid" class="setup-grid-container">
            <p style="text-align:center; opacity:0.3; margin-top:50px;">LOADING FEED...</p>
        </div>
    </div>
  </div>

<div id="upScr" class="screen">
    <div class="modal">
        <button class="close-icon" onclick="closeScreen('upScr')">×</button>
        <h2>WEBSITE LOGS</h2>
        
        <div style="margin-bottom:10px;">

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">PLAYGROUND</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">PROJECTS & CAMERA PRESETS</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>ENHANCE YOUR PHOTOGRAPHY WITH CAMERA PRESETS OR SHARE YOUR NOTHING-RELATED PROJECTS. FOR SAFETY, ALL LINKS ARE ADMIN-VERIFIED; VERIFIED PROJECTS FEATURE A BLUE TICK AND UNLOCKED ACCESS TO BUILD TRUST WITHIN THE COMMUNITY.</p>
                </div>
            </div>

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">SETUP LAYOUTS</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">CUSTOM HOME SCREENS</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>SHARE YOUR HOME OR LOCK SCREEN SETUPS WITH DETAILS ON ICONS AND WIDGETS. USERS CAN DOWNLOAD WALLPAPERS AND UPVOTE LAYOUTS, WITH TOP-LIKED SETUPS RANKING AUTOMATICALLY. PLEASE ENSURE CORRECT CATEGORIZATION AND INCLUDE CLEAR DESCRIPTIONS.</p>
                </div>
            </div>

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">COMMUNITY BOARD</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">PUBLIC FEEDBACK & SUGGESTIONS</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>REPORT BROKEN UI, DEAD LINKS, OR SUGGEST IMPROVEMENTS WITHOUT NEEDING TO LOG IN. OUR PUBLIC CHAT ALLOWS EVERYONE TO DISCUSS AND REFINE FEEDBACK IN REAL-TIME TO BUILD A BETTER EXPERIENCE TOGETHER.</p>
                </div>
            </div>

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">RINGTONE PLAYER</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">INSTANT SEARCH & PLAY</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>INSTANTLY SEARCH, PLAY, AND DOWNLOAD RINGTONES FROM MOVIES, ARTISTS, OR TRENDS. SUPPORTS BACKGROUND PLAYBACK AND REMAINS COMPLETELY AD-FREE FOR A DISTRACTION-FREE EXPERIENCE WITH SEAMLESS NAVIGATION.</p>
                </div>
            </div>

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">WALLPAPER GALLERY</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">EXCLUSIVE & AI GENERATED</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>ACCESS EXCLUSIVE HIGH-QUALITY WALLPAPERS OR CREATE YOUR OWN USING OUR AI GENERATOR. SIMPLY CHOOSE YOUR DEVICE FORMAT--MOBILE OR DESKTOP--AND GENERATE UNIQUE ART TAILORED TO YOUR AESTHETIC.</p>
                </div>
            </div>

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">FIRMWARE UPDATE</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">NOTHING & CMF OS ZIPS</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>MANUAL ACCESS TO THE LATEST FIRMWARE VERSIONS FOR NOTHING AND CMF DEVICES. IDEAL FOR USERS WHO HAVEN'T RECEIVED OFFICIAL OTA ROLLOUTS AND WISH TO UPGRADE FROM THEIR PREVIOUS VERSION TO THE LATEST RELEASE.</p>
                </div>
            </div>

            <div class="guide-box">
                <div class="guide-header" onclick="toggleItem(this)">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h4 style="margin:0; font-size:1.4rem; color:var(--text);">SERVICE DATABASE</h4>
                        <p style="margin:0; opacity:0.6; font-size:0.9rem;">MAPS & DIRECT CALL</p>
                    </div>
                    <div class="arrow-wrapper" style="position:static;">
                        <div class="dot-arrow">
                            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
                            <div class="dot-row"><div class="dot"></div></div>
                        </div>
                    </div>
                </div>
                <div class="guide-content">
                    <p>EASILY LOCATE THE NEAREST SERVICE CENTER WITH ONE-TAP GOOGLE MAPS INTEGRATION AND DIRECT CALL SUPPORT. GET PRECISE ADDRESSES AND CONTACT DETAILS WITHOUT THE NEED FOR MANUAL SEARCHING.</p>
                </div>
            </div>

        </div>
    </div>
</div>

  <div id="feedbackScr" class="screen">
    <div class="modal" style="height: 80dvh; display: flex; flex-direction: column;">
      <button class="close-icon" onclick="closeScreen('feedbackScr')">×</button>
      <h2>COMMUNITY BOARD</h2>
      <p style="opacity: 0.4; font-size: 0.8rem; margin-bottom: 15px;">PUBLIC FEEDBACK & CHAT</p>
      
      <div id="msgBoard" style="flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth;"></div>
      
      <div style="background: var(--card); border: 1px solid var(--border); border-radius: 30px; overflow: hidden; margin-top: 15px; position: sticky; bottom: 0;">
        
        <div id="replyBanner">
            <div class="reply-info">
                <span style="font-size:0.7rem; color:var(--accent); font-weight:bold;">REPLYING TO</span>
                <span id="replyText">User message...</span>
            </div>
            <button onclick="cancelReply()" class="close-reply-btn">×</button>
        </div>

        <div style="padding: 5px 5px 5px 15px; display: flex; align-items: center;">
            <img id="imgPreview" src="" onclick="clearImage()" title="Click to remove">
            
            <input type="text" id="userMsg" placeholder="SHARE SUGGESTION..." aria-label="Type Message" style="flex: 1; background: transparent; border: none; color: var(--text); outline: none; font-family: 'VT323' !important; font-size: 1.2rem;">
            
            <input type="file" id="imgInput" accept="image/*" style="display: none;" onchange="handleFileSelect()">
            
            <button id="imgUploadBtn" onclick="document.getElementById('imgInput').click()" style="width: 40px; height: 40px; border-radius: 50%; background: transparent; color: var(--text); border: none; cursor: pointer; margin-right: 5px; display: none;">
                <i class="fa-solid fa-image"></i>
            </button>

            <button id="sendBtn" onclick="sendMsg()" aria-label="Send Message" style="width: 45px; height: 45px; border-radius: 50%; background: var(--text); color: var(--bg); border: none; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <i class="fa-solid fa-arrow-up"></i>
            </button>
        </div>
      </div>
    </div>
  </div>

  <div id="musicScr" class="screen">
    <div class="modal">
      <button class="close-icon" onclick="handleMusicClose()">×</button>
      <h2>RINGTONE PLAYER</h2> 
      <div class="music-ui">
        <div class="search-box-m">
          <input type="text" id="mQuery" placeholder="SEARCH SONG...">
          <button class="go-btn" id="mSearchBtn" onclick="searchMusic()"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
      </div>
      
      <div id="music-card">
        <img src="" id="mArt" class="disc" alt="Album Art">
        
        <h3 id="mTitle" style="margin-top:15px;">TITLE</h3>
        <p id="mArtist" style="opacity:0.5;">ARTIST</p>
        <div class="m-ctrls">

          <i class="fa-solid fa-backward-step" onclick="prevSong()" style="cursor:pointer"></i>
          <span id="play-pause" onclick="togglePlay()" style="cursor:pointer"><i class="fa-solid fa-circle-play"></i></span>
          <i class="fa-solid fa-forward-step" onclick="nextSong()" style="cursor:pointer"></i>
        </div>
        <button class="btn" onclick="downloadCurrentSong()">PREVIEW TONE</button>
      </div>
      <audio id="mPlayer" onended="nextSong()"></audio>
    </div>
  </div>

<div id="swScr" class="screen">
    <div class="modal">
      <button class="close-icon" onclick="closeScreen('swScr')">×</button>
      <h2>SYSTEM UPDATE</h2>
      <div class="guide-box">
        <div class="guide-header" onclick="toggleAccordion()">
          <span>HOW TO UPDATE?</span>
          <div class="arrow-wrapper" style="position:static;"><div class="dot-arrow"><div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div><div class="dot-row"><div class="dot"></div><div class="dot"></div></div><div class="dot-row"><div class="dot"></div></div></div></div>
        </div>
        <div class="guide-content" id="accContent">
          <p>1. DOWNLOAD THE BETA HUB TOOL APK.<br>2. CREATE "OTA" FOLDER IN INTERNAL STORAGE AND PASTE OTA ZIP INSIDE.<br>3. SETTING - SYSTEM - BETA HUB - IMPORT FILE - ZIP - UPDATE.</p>
          <button class="btn" style="font-size:1.6rem; padding:17px;"  onclick="runDownload(this, 'BETA_TOOL')"><div class="progress-bar"></div><span class="btn-text">DOWNLOAD BETA TOOL</span></button>
        </div>
      </div>

      <div class="sw-display" id="swDisplay">
        <div class="sw-img-box">
          <img src="" id="swPhoneImg" style="cursor: pointer;" alt="Phone Image" onmousedown="startSoftwareLogic()" ontouchstart="startSoftwareLogic()" onmouseup="cancelSoftwareLogic()" onmouseleave="cancelSoftwareLogic()" ontouchend="cancelSoftwareLogic()" ontouchmove="cancelSoftwareLogic()">
        </div>
        <div class="sw-info">
          <h2 id="swPhoneTitle">DEVICE</h2>
          <p style="opacity:0.5; font-size:0.9rem;">UN-Official OTA Firmware</p>
        </div>
      </div>

      <div class="input-group">
        <div class="custom-select-trigger" onclick="openDeviceMenu()">
          <span id="deviceTriggerText">SELECT YOUR DEVICE</span>
          <div class="dot-arrow">
            <div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div>
            <div class="dot-row"><div class="dot"></div><div class="dot"></div></div>
            <div class="dot-row"><div class="dot"></div></div>
          </div>
        </div>
        <input type="hidden" id="swSelect" value=""> 
      </div>

      <div id="logBox" style="display:none;" class="detail-card">
           <div style="display: inline-flex; align-items: center; gap: 8px; background: transparent;">
    <h3 style="text-transform: none; margin: 0; font-family: sans-serif; color: var(--text); font-size: 18px; font-weight: 800;">
        Src. Spike0en 
    </h3>
</div>  
        <ul id="swList" style="margin:15px 0; opacity:0.7; list-style: inside; text-transform: none;"></ul>
        <button class="btn" onclick="runDownload(this, 'OTA_ZIP')"><div class="progress-bar"></div><span class="btn-text">PREVIEW OTA ZIP</span></button>
      </div>
    </div>
  </div>
  <div id="pgScr" class="screen">
    <div class="modal">
      <button class="close-icon" onclick="closeScreen('pgScr')">×</button>
      <h2>PLAYGROUND</h2>
      <div style="margin-top:20px;">
          <div class="pg-btn" onclick="openScreen('presetScr')"><span>CAMERA PRESETS</span><i class="fa-solid fa-camera"></i></div>
          <div class="pg-btn" onclick="openProjectScreen()"><span>COMMUNITY PROJECTS</span><i class="fa-solid fa-code"></i></div>
     </div>
    </div>
  </div>

  <div id="presetScr" class="screen">
    <div class="modal">
      <button class="close-icon" onclick="closeScreen('presetScr')">×</button>
      <h2>CAMERA PRESETS</h2>
      <p style="opacity:0.5; margin-bottom:10px;">EXCLUSIVE PRESETS</p>
      <div class="wp-grid" id="presetGrid"></div>
    </div>
  </div>

<div id="projectScr" class="screen">
    <div class="modal">
        <button class="close-icon" onclick="closeScreen('projectScr')">×</button>
        
        <h2 id="prjHubTitle" onclick="handleProjectAdmin()" style="cursor:pointer; user-select:none;">COMMUNITY HUB</h2>
        
        <div style="display:flex; gap:10px; margin-bottom:0px;">
            <button class="pg-btn" onclick="switchProjectTab('feed')" id="btnFeed" style="background:var(--card); color:var(--text);">EXPLORE</button>
            <button class="pg-btn" onclick="switchProjectTab('upload')" id="btnUpload" style="background:var(--card); color:var(--text);">UPLOAD</button>
        </div>

        <div id="projectFeed">
            <p style="text-align:center; opacity:0.5; margin-top:50px;">FETCHING PROJECTS...</p>
        </div>

        <div id="projectForm" style="display:none;">
            <div class="upload-box">
                <p style="text-align:center; opacity:0.5; margin-bottom:10px;"> AUTHOR PROFILE OR LOGO</p>
                <label class="pfp-select">
                    <img id="pfpPrv" src="" style="display:none; width:100%; height:100%; object-fit:cover;">
                    <i class="fa-solid fa-camera" id="pfpIcon"></i>
                    <input type="file" hidden accept="image/*" onchange="handlePrjFile(this, 'pfpPrv', 'avatar')">
                </label>

                <div class="input-group">
    <input type="text" id="prjAuthor" placeholder="YOUR NAME" maxlength="20">
</div>

<div class="input-group">
    <input type="text" id="prjTitle" placeholder="PROJECT TITLE" maxlength="25">
</div>

<div class="input-group">
    <textarea id="prjDesc" placeholder="DESCRIPTION" rows="3" maxlength="150"></textarea>
</div>

<div class="input-group">
    <input type="text" id="prjUrl" placeholder="PROJECT URL">
</div>

                <p style="color:var(--accent); font-size:0.9rem; margin:10px 0 5px;">SCREENSHOTS (REQUIRED)</p>
                <div class="upload-grid" style="grid-template-columns: repeat(3, 1fr); gap:10px;">
                    <div class="upload-area" style="height:80px; border:1px dashed #555; display:grid; place-items:center;" onclick="document.getElementById('prjImg1').click()"><div id="prv1" style="font-size:0.7rem;">IMG 1</div></div>
                    <div class="upload-area" style="height:80px; border:1px dashed #555; display:grid; place-items:center;" onclick="document.getElementById('prjImg2').click()"><div id="prv2" style="font-size:0.7rem;">IMG 2</div></div>
                    <div class="upload-area" style="height:80px; border:1px dashed #555; display:grid; place-items:center;" onclick="document.getElementById('prjImg3').click()"><div id="prv3" style="font-size:0.7rem;">IMG 3</div></div>
                </div>

                <input type="file" id="prjImg1" hidden onchange="handlePrjFile(this, 'prv1', 'img1')">
                <input type="file" id="prjImg2" hidden onchange="handlePrjFile(this, 'prv2', 'img2')">
                <input type="file" id="prjImg3" hidden onchange="handlePrjFile(this, 'prv3', 'img3')">

                <button class="btn" id="prjPushBtn" onclick="pushProjectData()" style="margin-top:20px;">
                    <div class="progress-bar"></div><span class="btn-text">PUBLISH PROJECT</span>
                </button>
            </div>
        </div>
    </div>
</div>

  <div id="wpScr" class="screen">

<div class="modal">
  <button class="close-icon" onclick="closeScreen('wpScr')">×</button>
  <h2>GALLERY</h2>

  <div class="controls" style="display: flex; gap: 14px; margin-bottom: 15px; flex-wrap: wrap;">
    <button class="tab-btn" onclick="toggleGenerator('mobile')">MOBILE</button>
    <button class="tab-btn" onclick="toggleGenerator('desktop')">DESKTOP</button>
  </div>

  <div id="genUI" class="preview-container">
    <div id="mainCard" class="nothing-card dotted-bg">
      <div class="img-wrapper" oncontextmenu="return false;">
        <img id="wallImg" src="" alt="Wallpaper Preview">
      </div>
      <div class="card-footer">
        <div class="action-btns">
          <button class="save-pill" onclick="downloadWall()">SAVE</button>
          <button class="next-pill" onclick="generateWall()">NEXT</button>
          <div id="statusText" class="status-tag">GEN🪄</div>
        </div>
      </div>
    </div>
  </div>

     <div class="wp-grid" id="wallpaperGrid"></div>
    </div>
  </div>

  
  <div id="scScr" class="screen">
    <div class="modal">
      <button class="close-icon" onclick="closeScreen('scScr')">×</button>
      <h2>SERVICE CENTERS</h2>
      
      <div class="input-group" style="margin-top:20px;">
        <div class="custom-select-trigger" onclick="openStateMenu()">
          <span id="stateTriggerText">SELECT STATE</span>
          <div class="arrow-wrapper"><div class="dot-arrow"><div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div><div class="dot-row"><div class="dot"></div><div class="dot"></div></div><div class="dot-row"><div class="dot"></div></div></div></div>
        </div>
        <input type="hidden" id="state" value="">
      </div>

      <div class="input-group" id="cityGroup" style="display:none;">
        <div class="custom-select-trigger" onclick="openCityMenu()">
          <span id="cityTriggerText">SELECT CITY</span>
          <div class="arrow-wrapper"><div class="dot-arrow"><div class="dot-row"><div class="dot"></div><div class="dot" style="visibility:hidden"></div><div class="dot"></div></div><div class="dot-row"><div class="dot"></div><div class="dot"></div></div><div class="dot-row"><div class="dot"></div></div></div></div>
        </div>
        <input type="hidden" id="city" value="">
      </div>

      <div id="scInfo"></div>
    </div>
  </div>
<div id="dropScr" class="screen">
    <div class="modal">
      <button class="close-icon" onclick="closeScreen('dropScr')">×</button>
      <h2>FILE DROP</h2>
      <p style="opacity:0.5; margin-bottom:15px; font-size: 0.9rem;">SECURE WIFI DIRECT</p>
      
      <div class="controls" style="display: flex; gap: 10px; margin-bottom: 20px; width: 100%;">
          <button class="tab-btn" style="flex: 1; padding: 12px; min-width: 0;" onclick="switchDropTab('recv')">RECEIVE</button>
          <button class="tab-btn" style="flex: 1; padding: 12px; min-width: 0;" onclick="switchDropTab('send')">SEND</button>
      </div>

      <div id="recvTab" style="display:none; text-align:center;">
          <div id="recvInitialUI">
              <div id="dropQrCode" style="background:white; padding:15px; display:inline-block; border-radius:15px; margin:10px 0 15px; border: 2px solid var(--border);"></div>
              <p style="opacity: 0.5; margin-bottom: 5px;">8-DIGIT SECURE PIN</p>
              <div class="code-box" id="dropMyCode" style="font-size:2rem; letter-spacing:4px; font-weight:bold; color:var(--text); background: var(--card); padding: 10px; border-radius: 10px; border: 1px dashed var(--border);">...</div>
          </div>
          <div id="recvConnectedUI" style="display:none;">
              <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom: 20px;">
                  <div class="status-pill">
                      <div style="width:10px; height:10px; background:#00ff00; border-radius:50%; box-shadow: 0 0 10px #00ff00;"></div> RECEIVER CONNECTED
                  </div>
                  <button class="disconnect-btn-inline" onclick="disconnectDrop()" title="Disconnect"><i class="fa-solid fa-xmark"></i></button>
              </div>

              <div id="dropTextLogs" style="max-height: 250px; overflow-y: auto; text-align: left; display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;"></div>
          </div>
      </div>

      <div id="sendTab" style="display:none; text-align:center;">
          <div id="senderInitialUI">
              <div class="animated-drop-zone" onclick="startDirectScanner()" id="scannerTrigger" style="margin-bottom: 10px; height: 120px;">
                  <div class="drop-zone-bg-anim"></div>
                  <div class="drop-zone-content">
                      <i class="fa-solid fa-qrcode"></i>
                      <span style="font-weight:bold; font-size: 1.1rem; letter-spacing:1px;">TAP TO SCAN QR</span>
                  </div>
              </div>
              <div id="dropReader" style="margin-bottom: 10px;"></div>
              <p id="scannerLoader" style="display:none; margin: 15px 0; opacity: 0.6; font-size:1.1rem;"><i class="fa-solid fa-spinner fa-spin"></i> STARTING CAMERA...</p>
              
              <p class="desktop-only" style="opacity:0.4; margin:15px 0; font-size: 0.9rem; letter-spacing: 2px;">— OR —</p>
              
              <div class="desktop-only desktop-input-group">
                  <input type="text" id="manualDropCode" placeholder="ENTER 8-DIGIT PIN" maxlength="8">
                  <button class="inside-btn" onclick="connectDropManual()"><i class="fa-solid fa-arrow-right"></i></button>
              </div>
          </div>

          <div id="dropSendSection" style="display:none; margin-top:5px;">
              
              <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom: 15px;">
                  <div class="status-pill">
                      <div style="width:10px; height:10px; background:#00ff00; border-radius:50%; box-shadow: 0 0 10px #00ff00;"></div> SENDER CONNECTED
                  </div>
                  <button class="disconnect-btn-inline" onclick="disconnectDrop()" title="Disconnect"><i class="fa-solid fa-xmark"></i></button>
              </div>
              
              <textarea id="dropTextInput" class="text-drop-area" rows="2" placeholder="TYPE OR PASTE TEXT HERE..."></textarea>
              
              <input type="file" id="dropFileInput" multiple hidden onchange="updateDropFileLabel()">
              
              <div class="animated-drop-zone" onclick="document.getElementById('dropFileInput').click()" style="margin-bottom: 15px; height: 90px;">
                  <div class="drop-zone-bg-anim"></div>
                  <div class="drop-zone-content">
                      <i class="fa-solid fa-file-circle-plus" id="dropFileIcon" style="font-size: 1.8rem;"></i>
                      <span id="dropFileLabel" style="font-weight:bold; opacity: 0.8; font-size: 1rem; letter-spacing:1px;">SELECT FILES</span>
                  </div>
              </div>

              <button class="btn" onclick="sendDropData()" id="dropSendBtn" style="width: 100%; margin: 0; background: var(--text); color: var(--bg); border-radius: 18px; font-size: 1.2rem;"><i class="fa-solid fa-paper-plane"></i> SEND DATA</button>
          </div>
      </div>
      
      <div id="dropStatus" style="margin-top:15px; padding:12px; border-radius:12px; background:var(--card); border:1px solid var(--border); display:none; text-align:center; font-weight:bold; font-size: 1rem;"></div>
    </div>
</div>
      <div id="aboutScr" class="screen">
      <div class="modal">
        <span class="close-icon" onclick="closeScreen('aboutScr')">×</span>
        <h2>ABOUT US</h2>
        <p style="text-align:center; opacity:0.6; font-size:0.9rem; margin-bottom:15px; letter-spacing:1px;">ESTABLISHED 2026 • COMMUNITY DRIVEN</p>
        
        <div class="detail-card">
          <p>
            Welcome to <b>Nothing Space</b>. We are a dedicated open-source resource hub built for enthusiasts of the Nothing™ technology ecosystem. Our mission is to bridge the gap between complex developer resources and the average user.
          </p>
          
          <h3 style="margin-top:20px; font-size:1.2rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:5px;">OUR MISSION</h3>
          <p>
            To provide a safe, ad-free (pop-up free), and direct download environment for Firmware, wallpaper, Preset, and Tools. We believe in the "Right to Repair" and "Device Customization" philosophies.
          </p>

          <h3 style="margin-top:20px; font-size:1.2rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:5px;">EDITORIAL STANDARDS</h3>
          <p>
            Reliability is our core value. To ensure user safety, every file hosted on Nothing Space undergoes a strict 3-step verification process:
          </p>
          <ul style="margin-left:20px; opacity:0.8; list-style:square; margin-top:10px;">
            <li><b>Source Verification:</b> We verify firmware details using publicly available official release data.
 We do not host or redistribute firmware files and only direct users to official sources when applicable.</li>
            <li><b>Security Scanning:</b> All APKs are scanned via VirusTotal APIs before listing to ensure 0% malware.</li>
            <li><b>Manual Testing:</b> Our internal team tests UI wallpaper, Preset on real hardware (Phone 1/2) to ensure stability.</li>
          </ul>
                  <h3 style="margin-top:20px; font-size:1.2rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:5px;">THE TEAM</h3>
          
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
            <div style="background:rgba(255,255,255,0.05);border:1px solid var(--border);padding:10px; border-radius:10px; text-align:center;">
                <span style="font-size:0.8rem; opacity:0.6;">LEAD DEVELOPER</span><br><b>ROHit</b>
            </div>
            <div style="background:rgba(255,255,255,0.05);border:1px solid var(--border);padding:10px; border-radius:10px; text-align:center;">
                <span style="font-size:0.8rem; opacity:0.6;">HQ LOCATION</span><br><b>Bihar, India</b>
            </div>
          </div>

          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
            <div style="background:rgba(255,255,255,0.05);border:1px solid var(--border);padding:10px; border-radius:10px; text-align:center;">
                <span style="font-size:0.8rem; opacity:0.6;">FIRMWARE MAINTAINER</span><br><b>Spike0en</b>
            </div>
            <div style="background:rgba(255,255,255,0.05);border:1px solid var(--border);padding:10px; border-radius:10px; text-align:center;">
                <span style="font-size:0.8rem; opacity:0.6;">HQ LOCATION</span><br><b>Delhi, India</b>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="privacyScr" class="screen">
      <div class="modal">
        <span class="close-icon" onclick="closeScreen('privacyScr')">×</span>
        <h2>PRIVACY POLICY</h2>
        <div class="detail-card">
          <p style="font-size:0.9rem; opacity:0.6; margin-bottom:15px;">Last Updated: January 16, 2026</p>
          
          <p>At Nothing Space (accessible from nothingtools.github.io), safeguarding the privacy of our visitors is one of our primary objectives. This Privacy Policy document contains types of information that is collected and recorded by Nothing Space and how we use it.</p>

          <h3 style="margin-top:20px; font-size:1.1rem;">1. INFORMATION COLLECTION</h3>
          <p>
            <b>Personal Data:</b> We do not require you to create an account or provide personal details (like Name, Phone Number, Address) to access our downloads.<br>
            <b>Voluntary Data:</b> If you contact us via email, we will only use your email address to reply to your query. It will never be sold or shared.
          </p>

          <h3 style="margin-top:20px; font-size:1.1rem;">2. GOOGLE ADSENSE & COOKIES</h3>
          <p>We partner with Google AdSense to display advertisements. Google uses cookies, known as DART cookies, to serve ads to our site visitors based upon their visit to our site and other sites on the internet.</p>
          <div style="margin-top:10px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; font-size:0.9rem;">
            <b>OPT-OUT:</b> You may choose to decline the use of DART cookies by visiting the Google Ad and Content Network Privacy Policy at <a href="https://policies.google.com/technologies/ads" target="_blank" style="text-decoration:underline;">policies.google.com</a>.
          </div>

          <h3 style="margin-top:20px; font-size:1.1rem;">3. GDPR DATA PROTECTION RIGHTS</h3>
          <p>We would like to make sure you are fully aware of all of your data protection rights. Every user is entitled to the following:</p>
          <ul style="margin-left:20px; opacity:0.8; list-style:circle; margin-top:5px;">
              <li>The right to access – You have the right to request copies of your personal data.</li>
              <li>The right to rectification – You have the right to request that we correct any information you believe is inaccurate.</li>
              <li>The right to erasure – You have the right to request that we erase your personal data, under certain conditions.</li>
          </ul>

          <h3 style="margin-top:20px; font-size:1.1rem;">4. CCPA PRIVACY RIGHTS</h3>
          <p>Under the CCPA, among other rights, California consumers have the right to request that a business that collects a consumer's personal data disclose the categories and specific pieces of personal data that a business has collected about consumers.</p>

          <h3 style="margin-top:20px; font-size:1.1rem;">5. LOG FILES</h3>
          <p>Nothing Space follows a standard procedure of using log files. The data collected includes internet protocol (IP) addresses, browser type, ISP, date/time stamp, and referring/exit pages. This information is used for analyzing trends and preventing DDoS attacks.</p>
        </div>
      </div>
    </div>

    <div id="termsScr" class="screen">
      <div class="modal">
        <span class="close-icon" onclick="closeScreen('termsScr')">×</span>
        <h2>TERMS OF USE</h2>
        <div class="detail-card">
          <p>By accessing this website, you confirm that you understand and agree to comply with these terms and conditions. Do not continue to use Nothing Space if you do not agree to all of the terms stated on this page.</p>

          <h3 style="margin-top:20px; font-size:1.1rem;">1. INTELLECTUAL PROPERTY</h3>
          <p>Unless otherwise stated, Nothing Space and/or its licensors own the intellectual property rights for all original material on this website. All intellectual property rights are reserved.</p>
          <ul style="margin-left:20px; opacity:0.8; list-style:square; margin-top:5px;">
            <li>You must not republish material from Nothing Space.</li>
            <li>You must not sell, rent, or sub-license material from Nothing Space.</li>
            <li>You must not reproduce, duplicate or copy material from Nothing Space without permission.</li>
          </ul>

          <h3 style="margin-top:20px; font-size:1.1rem;">2. LIMITATION OF LIABILITY</h3>
          <p>The content and tools on Nothing Space are provided "as is". We make no warranties, expressed or implied.</p>
          <p style="margin-top:10px;">
            <b>Device Safety:</b> The firmware links, APKs, and guides provided are for educational and customization purposes. Modifying system software (Flashing OTA, Unlocking Bootloader) carries inherent risks. Nothing Space and its developers are <b>NOT responsible</b> for any damage to your device, data loss, or voiding of warranty. Always backup your data.
          </p>

          <h3 style="margin-top:20px; font-size:1.1rem;">3. GOVERNING LAW</h3>
          <p>These terms and conditions are governed by and construed in accordance with the laws of <b>India</b>. You irrevocably submit to the exclusive jurisdiction of the courts in the State of <b>Bihar</b> for the resolution of any disputes.</p>
        </div>
      </div>
    </div>

    <div id="disclaimerScr" class="screen">
      <div class="modal">
        <span class="close-icon" onclick="closeScreen('disclaimerScr')">×</span>
        <h2>LEGAL DISCLAIMER</h2>
        <div class="detail-card">
          
          <div style="border: 2px solid var(--text); padding: 15px; border-radius: 15px; margin-bottom: 20px; background: rgba(255,255,255,0.05);">
            <p style="margin:0; font-weight:bold; font-size:1.1rem; text-align:center;">
                ⚠ UNOFFICIAL FAN PROJECT
            </p>
            <p style="margin-top:10px; font-size:0.95rem;">
               Nothing Space is an independent, community-run resource hub. We are <u>NOT</u> affiliated, associated, authorized, endorsed by, or in any way officially connected with <b>Nothing Technology Limited</b>, CMF, or any of their subsidiaries.
            </p>
          </div>

          <h3 style="font-size:1.1rem;">TRADEMARKS</h3>
          <p>
            The names "Nothing", "Phone (1)", "Phone (2)", "Phone (2a)", "CMF" and related marks, emblems, and images are registered trademarks of their respective owners. We use these names solely for descriptive purposes to identify the devices our resources are intended for. This constitutes <b>"Fair Use"</b> under copyright law.
          </p>

          <h3 style="margin-top:20px; font-size:1.1rem;">CONTENT ACCURACY</h3>
          <p>
            While we strive to keep the information up to date and correct, we make no representations or warranties of any kind about the completeness, accuracy, reliability, suitability or availability with respect to the website or the information contained on the website.
          </p>
        </div>
      </div>
    </div>

    <div id="contactScr" class="screen">
      <div class="modal">
        <span class="close-icon" onclick="closeScreen('contactScr')">×</span>
        <h2>GET IN TOUCH</h2>
        <div class="detail-card">
          <p style="text-align:center; margin-bottom:20px;">Have a suggestion for the site, found a broken link, or have a DMCA request? Choose a method below.</p>
          
          <div style="background:rgba(0, 136, 204, 0.1); border:1px solid #0088cc; padding:15px; border-radius:15px; text-align:center; margin-bottom:15px;">
            <i class="fa-brands fa-telegram" style="font-size:2.5rem; color:#0088cc; display:block; margin-bottom:5px;"></i>
            <p style="opacity:0.6; margin-bottom:5px; font-size:0.8rem;">JOIN OUR COMMUNITY CHANNEL</p>
            <a href="https://t.me/techiboy_discuss" target="_blank" style="color:#fff; background:#0088cc; padding:8px 15px; border-radius:5px; text-decoration:none; font-weight:bold; display:inline-block;">OPEN TELEGRAM <i class="fa-solid fa-arrow-up-right-from-square"></i></a>
          </div>

          <div style="background:rgba(255,255,255,0.05); border:1px solid var(--border); padding:15px; border-radius:15px; text-align:center;">
            <i class="fa-solid fa-envelope" style="font-size:1.5rem; display:block; margin-bottom:5px;"></i>
            <p style="opacity:0.6; margin-bottom:5px; font-size:0.8rem;">OFFICIAL SUPPORT EMAIL</p>
            <a href="mailto:rkkiller298@gmail.com" style="color:var(--text); text-decoration:underline; font-size:1.2rem;">rkkiller298@gmail.com</a>
          </div>

          <h3 style="margin-top:20px; font-size:1.1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:5px;">OPERATIONAL DETAILS</h3>
          <ul style="margin-left:20px; opacity:0.8; list-style:square; margin-top:10px;">
          <li><b>Response:</b> Within 24-48 Hours</li>
           <li><b>Region:</b> Bihar, India</li>
       <li><b>Legal Contact:</b> Use the email above for takedown requests.</li>
                 </ul>
        </div>
      </div>
    </div>

    <footer>
        <div class="footer-links">
          <button type="button" onclick="openScreen('aboutScr')" 
style="background:none; border:none; padding:0; font:inherit; cursor:pointer; color:inherit; text-decoration:underline; text-underline-offset:4px;">
  ABOUT
</button>

<button type="button" onclick="openScreen('privacyScr')" 
style="background:none; border:none; padding:0; font:inherit; cursor:pointer; color:inherit; text-decoration:underline; text-underline-offset:4px;">
  PRIVACY
</button>

<button type="button" onclick="openScreen('termsScr')" 
style="background:none; border:none; padding:0; font:inherit; cursor:pointer; color:inherit; text-decoration:underline; text-underline-offset:4px;">
  TERMS
</button>

<button type="button" onclick="openScreen('disclaimerScr')" 
style="background:none; border:none; padding:0; font:inherit; cursor:pointer; color:inherit; text-decoration:underline; text-underline-offset:4px;">
  DISCLAIMER
</button>

<button type="button" onclick="openScreen('contactScr')" 
style="background:none; border:none; padding:0; font:inherit; cursor:pointer; color:inherit; text-decoration:underline; text-underline-offset:4px;">
  CONTACT
</button>
        </div>
      
       <p class="disclaimer">
                <strong>Disclaimer:</strong> Nothing Space is an independent community project and is NOT affiliated, associated, authorized, endorsed by, or in any way officially connected with Nothing Technology Ltd or its subsidiaries. "Nothing" and related names are registered trademarks of their respective owners.
            </p>
                  <p style="margin: 10px 0; font-size: 0.8rem; color: var(--text-sec);">© 2026 Nothing Space. Designed in India.</p>
      </footer> 

<script> /* ================= CONFIG & GLOBALS ================= */
    const CONFIG = {
        BETA_TOOL_URL: "https://github.com/nothingcommunity/Testing/raw/refs/heads/main/Apps/Beta%20Updates%20Hub.apk",
        SOFTWARE: {}, SERVICE_DB: {}, WALLPAPERS: []
    };
    const DB_URL = "https://nothingcommunity-7664f-default-rtdb.firebaseio.com/chat.json";
    const SETUP_DB_URL = "https://nothingcommunity-7664f-default-rtdb.firebaseio.com/setups.json";
    const ADMIN_UUID = "uid_mlok2lzlqwxksrly1fk";
    
    let SERVICE_DB = {}; 
    let currentPlaylist = [], currentIndex = 0, lastPlayedArt = "";
    let imgStore = { ssHome: null, ssLock: null, wallHome: null, wallLock: null };
    let currentReply = null; 

    // ================= INITIALIZATION =================
    window.addEventListener('load', () => {
        applyAutoTheme();
        createStars(); 
        createMoon();
        checkVerifyStatus(); 
        setTimeout(() => { initSoftwareData(); initServiceData(); loadMessages(); }, 100);
    });

    /* ================= THEME & UI ================= */
    function applyAutoTheme() {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        updateThemeIcon(prefersDark ? 'dark' : 'light');
    }
    function toggleTheme() {
        const root = document.documentElement;
        const newTheme = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', newTheme);
        updateThemeIcon(newTheme);
    }
    function updateThemeIcon(theme) { document.getElementById('t-icon').className = theme === 'dark' ? "fa-solid fa-circle" : "fa-solid fa-sun"; }

    function createStars() {
        requestAnimationFrame(() => {
            const field = document.getElementById('starField'); field.innerHTML = ''; const fragment = document.createDocumentFragment();
            const count = window.innerWidth < 768 ? 80 : 250; 
            for(let i=0; i < count; i++) {
                const s = document.createElement('div'); s.className = 'star';
                const size = Math.random() * 3;
                s.style.cssText = `width:${size}px; height:${size}px; top:${Math.random()*100}%; left:${Math.random()*100}%; animation: blink ${2+Math.random()*3}s infinite; opacity:${Math.random()}`;
                fragment.appendChild(s);
            }
            field.appendChild(fragment);
        });
    }
    function createMoon() { if(!document.querySelector('.moon')) { const moon = document.createElement('div'); moon.className = 'moon'; document.body.appendChild(moon); } }

    function attachScrollAnimation() {
        const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.remove('hidden-state'); entry.target.classList.add('scroll-active'); observer.unobserve(entry.target); } }); }, { threshold: 0.1 });
        document.querySelectorAll('.wp-card').forEach(card => { card.classList.add('hidden-state'); observer.observe(card); });
    }

    /* ================= NAVIGATION ================= */
    function openScreen(id) {
        const s = document.getElementById(id); if (!s) return;
        s.style.display = 'flex'; setTimeout(() => { s.classList.add('active'); }, 10);
        if(id === 'wpScr') initWallpaperData();
       if(id === 'hwScr') initHardware();
        if(id === 'presetScr') initPresetData();
        if(id === 'setupScr') loadSetups();
    }

    function closeScreen(id) {
        const s = document.getElementById(id); if (!s) return;
        s.classList.remove('active'); 
        setTimeout(() => { s.style.display = 'none'; if(id === 'wpScr') { const aiSec = document.getElementById('aiSection'); if(aiSec) aiSec.style.display = 'none'; } }, 400);
    }
    function toggleAI() { const section = document.getElementById('aiSection'); section.style.display = (section.style.display === 'none') ? 'block' : 'none'; }
    function toggleUpload() { const f = document.getElementById('setupUploadForm'); f.style.display = (f.style.display === 'none') ? 'block' : 'none'; }

    /* ================= CUSTOM SELECTOR LOGIC ================= */
    function openDeviceMenu() {
        const devices = [
            { name: "Nothing PHONE (1)", val: "p1" }, { name: "Nothing PHONE (2)", val: "p2" }, { name: "Nothing PHONE (2A)", val: "p2a" },
            { name: "Nothing PHONE (2A) PLUS", val: "p2aplus" }, { name: "Nothing PHONE (3)", val: "p3" }, { name: "Nothing PHONE (3A)", val: "p3a" },
            { name: "Nothing PHONE (3A) PRO", val: "p3apro" }, { name: "Nothing PHONE (3A) LITE", val: "p3alite" }, { name: "CMF PHONE 1", val: "cmf1" }, { name: "CMF PHONE 2 PRO", val: "cmf2pro" }
        ];
        openUniversalSelector("CHOOSE DEVICE", devices, (selected) => {
            document.getElementById('swSelect').value = selected.val;
            document.getElementById('deviceTriggerText').innerText = selected.name;
            showLogs(); 
        });
    }

    function openStateMenu() {
        const states = ["ANDHRA PRADESH", "ASSAM", "BIHAR", "CHANDIGARH", "CHHATTISGARH", "DELHI", "GOA", "GUJARAT", "HARYANA", "HIMACHAL PRADESH", "JAMMU & KASHMIR", "JHARKHAND", "KARNATAKA", "KERALA", "MADHYA PRADESH", "MAHARASHTRA", "MEGHALAYA", "NAGALAND", "ODISHA", "PUDUCHERRY", "PUNJAB", "RAJASTHAN", "TAMIL NADU", "TELANGANA", "TRIPURA", "UTTAR PRADESH", "UTTARAKHAND", "WEST BENGAL"].map(s => ({ name: s, val: s }));
        openUniversalSelector("SELECT STATE", states, (selected) => {
            document.getElementById('state').value = selected.val;
            document.getElementById('stateTriggerText').innerText = selected.name;
            document.getElementById('city').value = ""; document.getElementById('cityTriggerText').innerText = "SELECT CITY"; document.getElementById('scInfo').innerHTML = "";
            loadCitiesCustom(); 
        });
    }

    function openCityMenu() {
        const s = document.getElementById('state').value; if(!s || !SERVICE_DB[s]) return;
        const rawCities = [...new Set(Object.keys(SERVICE_DB[s]).map(c => c.split('_')[0]))].sort();
        const cityList = rawCities.map(c => ({ name: c, val: c }));
        openUniversalSelector("SELECT CITY", cityList, (selected) => {
            document.getElementById('city').value = selected.val;
            document.getElementById('cityTriggerText').innerText = selected.name;
            showDetails(); 
        });
    }
    function loadCitiesCustom() { const s = document.getElementById('state').value; document.getElementById('cityGroup').style.display = (!s || !SERVICE_DB[s]) ? 'none' : 'block'; }

    function openUniversalSelector(title, items, callback) {
        const titleEl = document.getElementById('selectorTitle'); const listEl = document.getElementById('selectorList');
        titleEl.innerText = title; listEl.innerHTML = "";
        items.forEach(item => {
            const div = document.createElement('div'); div.className = "selector-item";
            div.innerHTML = `<span>${item.name}</span> <i class="fa-solid fa-arrow-right" style="font-size:0.8rem; opacity:0.5;"></i>`;
            div.onclick = () => { if(navigator.vibrate) navigator.vibrate(30); callback(item); closeScreen('selectorScr'); };
            listEl.appendChild(div);
        });
        openScreen('selectorScr');
    }

    /* ================= DOWNLOAD LOGIC ================= */
    async function runDownload(btn, input) {
        const bar = btn.querySelector('.progress-bar'); const txt = btn.querySelector('.btn-text'); const oldTxt = txt.innerText; let finalUrl = "";
        if (input === 'BETA_TOOL') finalUrl = CONFIG.BETA_TOOL_URL;
        else if (input === 'OTA_ZIP') { const device = document.getElementById('swSelect').value; if(!device) { alert("PLEASE SELECT A DEVICE!"); return; } finalUrl = CONFIG.SOFTWARE[device]?.url; } 
        else finalUrl = input;
        if (!finalUrl || finalUrl === "#") { alert("LINK NOT FOUND!"); return; }
        btn.style.pointerEvents = 'none'; txt.innerText = 'PROCESSING...'; bar.style.transition = 'width 1.5s linear'; bar.style.width = '100%';
        const isZip = finalUrl.toLowerCase().endsWith('.zip') || finalUrl.toLowerCase().endsWith('.apk');
        if (isZip) {
            setTimeout(() => { const link = document.createElement('a'); link.href = finalUrl; link.target = "_blank"; document.body.appendChild(link); link.click(); document.body.removeChild(link); finishDownload(btn, txt, bar, oldTxt); }, 1000);
        } else {
            try {
                const response = await fetch(finalUrl); const blob = await response.blob(); const blobUrl = window.URL.createObjectURL(blob); const link = document.createElement('a'); link.href = blobUrl; link.download = "NothingSpace_" + Date.now() + ".png"; document.body.appendChild(link); link.click(); document.body.removeChild(link); window.URL.revokeObjectURL(blobUrl); finishDownload(btn, txt, bar, oldTxt);
            } catch (err) { window.open(finalUrl, '_blank'); finishDownload(btn, txt, bar, oldTxt); }
        }
    }
    function finishDownload(btn, txt, bar, oldTxt) { txt.innerText = "DONE ✓"; setTimeout(() => { bar.style.transition = 'none'; bar.style.width = '0%'; txt.innerText = oldTxt; btn.style.pointerEvents = 'all'; }, 1000); }

    /* ================= SOFTWARE & SERVICE DATA ================= */
    async function initSoftwareData() { try { const response = await fetch("https://nothingsoftware-3cc7c-default-rtdb.firebaseio.com/software_data.json"); const data = await response.json(); if (data) CONFIG.SOFTWARE = data; } catch (err) { console.error("SW Error:", err); } }
    function showLogs() {
        const m = document.getElementById('swSelect').value; const box = document.getElementById('logBox'), disp = document.getElementById('swDisplay');
        if(!m || !CONFIG.SOFTWARE[m]) { box.style.display = 'none'; disp.style.display = 'none'; return; }
        const data = CONFIG.SOFTWARE[m]; document.getElementById('swPhoneImg').src = data.img; document.getElementById('swPhoneTitle').innerText = data.disp;
        disp.style.display = 'flex'; document.getElementById('swList').innerHTML = (data.logs && Array.isArray(data.logs)) ? data.logs.map(l => `<li>${l}</li>`).join('') : "<li>Details not available</li>"; box.style.display = 'block';
    }
    function toggleAccordion() { document.getElementById('accContent').classList.toggle('open'); }
    async function initServiceData() { try { const response = await fetch("https://raw.githubusercontent.com/nothingcommunity/Testing/main/Service%20Centre/service_centre.json"); SERVICE_DB = await response.json(); } catch (err) { console.error("Service Data Error"); } }
    function showDetails() {
        const s = document.getElementById('state').value, c = document.getElementById('city').value, scInfo = document.getElementById('scInfo');
        if(!c || !SERVICE_DB[s]) return; scInfo.innerHTML = ''; 
        Object.keys(SERVICE_DB[s]).filter(key => key === c || key.startsWith(c + "_")).forEach(key => {
            const d = SERVICE_DB[s][key]; 
            scInfo.innerHTML += `<div class="detail-card"><div style="display:flex;justify-content:space-between;margin-bottom:10px;"><h3 style="font-size:1.4rem;">${d.n}</h3><span class="sc-badge">ID: ${d.c}</span></div><p style="text-transform:none;opacity:0.7;font-size:1rem;margin-bottom:15px;"><span style="font-size:1.2rem;">${d.a}</p><div style="font-size:0.9rem;margin-bottom:15px;"><p>🕒 TIME: ${d.t}</p><p>🚫 OFF : ${d.o}</p></div><div class="card-row"><button class="btn" style="flex:1;padding:12px;" onclick="window.open('tel:${d.p}')">CALL</button><button class="btn" style="flex:1;padding:12px;" onclick="window.open('${d.m}')">MAPS</button></div></div>`;
        });
    }
    let sw_timer; function startSoftwareLogic() { sw_timer = setTimeout(() => { if(navigator.vibrate) navigator.vibrate(50); openSoftwareMenu(); }, 500); }
    function cancelSoftwareLogic() { clearTimeout(sw_timer); }
    async function openSoftwareMenu() {
        if(userUUID !== ADMIN_UUID) return; 
        const id = document.getElementById('swSelect').value; const pass = prompt("🔐 SOFTWARE ADMIN PASSWORD:");
        if(stringToHash(pass) === "1540218401") {
            if(!id) { if(confirm("🆕 ADD NEW DEVICE?")) { const newId = prompt("Unique ID:"); if(!newId) return; const payload = { disp: prompt("Name:"), img: prompt("Img URL:"), url: prompt("Zip Link:"), logs: [prompt("Note:")] }; await fetch(`https://nothingsoftware-3cc7c-default-rtdb.firebaseio.com/software_data/${newId}.json`, {method:'PUT', body:JSON.stringify(payload)}); alert("ADDED!"); initSoftwareData(); } return; }
            const cur = CONFIG.SOFTWARE[id]; const choice = prompt(`EDIT ${cur.disp}:\n1.LINK\n2.NAME\n3.IMG\n4.NOTE`); let load = {};
            if(choice==="1") load={url:prompt("URL:", "")}; if(choice==="2") load={disp:prompt("NAME:", "")}; if(choice==="3") load={img:prompt("IMG:", "")};
            if(choice==="4") { const raw = prompt("NOTE (| for new line):", ""); if(raw) load={logs: raw.split('|').map(s=>s.trim())}; }
            if(Object.keys(load).length) { await fetch(`https://nothingsoftware-3cc7c-default-rtdb.firebaseio.com/software_data/${id}.json`, {method:'PATCH', body:JSON.stringify(load)}); alert("SAVED!"); initSoftwareData(); showLogs(); }
        } else { if(pass) alert("WRONG PASSWORD"); }
    }
      
  /* ================= HARDWARE LOGIC START ================= */
        let HW_DATA = [];
        let currentImgs = [];
        let currentModel = "";
        let hwTimer = null;
        let is3d = false;

        function vibrate(ms = 15) { if(navigator.vibrate) navigator.vibrate(ms); }

        async function initHardware() {
            const grid = document.getElementById('hwGrid');
            if(HW_DATA.length > 0) return;
            
            grid.innerHTML = "<p style='padding:20px; opacity:0.5; text-align:center;'>FETCHING...</p>";
            
            try {
                const res = await fetch("https://raw.githubusercontent.com/nothingtools/nothingtools.github.io/main/products/all.json?t=" + Date.now());
                if(!res.ok) throw new Error("HTTP Error");
                HW_DATA = await res.json();
                renderHW('all');
            } catch(e) { 
                console.error(e);
                grid.innerHTML = "<p style='color:var(--accent); text-align:center; padding:20px;'>FAILED TO LOAD.<br>CHECK INTERNET.</p>"; 
            }
        }

        function renderHW(cat) {
            const grid = document.getElementById('hwGrid');
            grid.innerHTML = "";
            
            const filtered = HW_DATA.filter(p => cat === 'all' || p.category === cat);
            
            if(filtered.length === 0) { 
                grid.innerHTML = "<p style='padding:20px; opacity:0.5; grid-column:span 2; text-align:center;'>NO ITEMS FOUND</p>"; 
                return; 
            }

            filtered.forEach(p => {
                const div = document.createElement('div');
                div.className = 'hw-card';
                
                let thumb = "";
                if (p.variants && p.variants[0]) thumb = p.variants[0].imgs[0];
                else if (p.imgs) thumb = p.imgs[0];
                
                div.innerHTML = `<img src="${thumb}"><h3>${p.name}</h3>`;
                div.onclick = () => { vibrate(20); openProduct(p); };
                grid.appendChild(div);
            });
        }

        function filterHW(cat, el) {
            vibrate(10);
            document.querySelectorAll('.hw-pill').forEach(p => p.classList.remove('active'));
            el.classList.add('active');
            renderHW(cat);
        }

        function openProduct(p) {
            exit3d(); 
            document.getElementById('dTitle').innerText = p.name;
            const cBox = document.getElementById('colorPicker');
            cBox.innerHTML = "";
            
            if (p.variants && p.variants.length > 0) {
                p.variants.forEach((v, idx) => {
                    const dot = document.createElement('div');
                    dot.className = `color-dot ${idx === 0 ? 'active' : ''}`;
                    dot.style.background = v.colorCode; 
                    dot.onclick = () => {
                        vibrate(10);
                        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                        dot.classList.add('active');
                        loadVariant(v); 
                    };
                    cBox.appendChild(dot);
                });
                loadVariant(p.variants[0]);
            } else {
                loadVariant({ imgs: p.imgs, model3d: p.model3d });
            }

            const sBox = document.getElementById('dSpecs');
            sBox.innerHTML = "";
            if(p.specs) {
                Object.entries(p.specs).forEach(([k, v]) => {
                    sBox.innerHTML += `<div class="row"><span>${k}</span><span>${v}</span></div>`;
                });
            }

            document.getElementById('buyLink').href = p.link || "#";

            const s = document.getElementById('hwDetailScr');
            s.style.display = 'flex'; setTimeout(() => s.classList.add('active'), 10);
        }

        function loadVariant(v) {
            currentImgs = v.imgs || [];
            currentModel = v.model3d || "";
            
            const track = document.getElementById('sliderTrack');
            track.innerHTML = currentImgs.map(src => `<div class="slide"><img src="${src}"></div>`).join('');
            track.scrollLeft = 0;
            
            document.getElementById('imgBadge').innerText = `1/${currentImgs.length}`;
            
            const showArrows = currentImgs.length > 1 ? 'flex' : 'none';
            document.getElementById('btnPrev').style.display = showArrows;
            document.getElementById('btnNext').style.display = showArrows;
        }

        function slide(dir) {
            vibrate(15);
            const track = document.getElementById('sliderTrack');
            track.scrollBy({ left: dir * track.clientWidth, behavior: 'smooth' });
        }

        document.getElementById('sliderTrack').addEventListener('scroll', (e) => {
            const track = e.target;
            const idx = Math.round(track.scrollLeft / track.clientWidth);
            document.getElementById('imgBadge').innerText = `${idx + 1}/${currentImgs.length}`;
        });

        const box = document.getElementById('vBox');
        let touchStartX = 0;

        box.addEventListener('touchstart', (e) => {
            if(is3d) return;
            touchStartX = e.touches[0].clientX;
            holdStart();
        }, {passive: true});

        box.addEventListener('touchmove', (e) => {
            if(is3d) return;
            if(Math.abs(e.touches[0].clientX - touchStartX) > 10) holdCancel();
        }, {passive: true});

        box.addEventListener('touchend', holdCancel);
        box.addEventListener('mousedown', holdStart);
        box.addEventListener('mouseup', holdCancel);
        box.addEventListener('mouseleave', holdCancel);

        function holdStart() {
            if(is3d || !currentModel) return; 
            document.querySelector('.bar').style.width = "100%";
            hwTimer = setTimeout(() => {
                vibrate(60); 
                const mv = document.getElementById('mv');
                mv.src = currentModel;
                document.getElementById('l3d').style.display = 'block';
                is3d = true;
            }, 600);
        }

        function holdCancel() {
            if(hwTimer) clearTimeout(hwTimer);
            document.querySelector('.bar').style.width = "0%";
        }

        function exit3d() {
            vibrate(10);
            is3d = false;
            document.getElementById('l3d').style.display = 'none';
        }

  /* ================= NOTHING SPACE WALLPAPER LOGIC ================= */
let currentMode = "";
let currentBlobUrl = ""; 

function toggleGenerator(mode) {
    const ui = document.getElementById('genUI');
    const card = document.getElementById('mainCard');

    if (currentMode === mode && ui.style.display === 'block') {
        ui.style.display = 'none';
        currentMode = "";
        return;
    }

    currentMode = mode;
    ui.style.display = 'block';
    card.className = `nothing-card dotted-bg mode-${mode}`;
    
    generateWall();
}

async function generateWall() {
    const img = document.getElementById('wallImg');
    const status = document.getElementById('statusText');
    
    const w = currentMode === 'mobile' ? 1080 : 1920;
    const h = currentMode === 'mobile' ? 1920 : 1080;
    const seed = Math.floor(Math.random() * 100000);
    
    const hdUrl = `https://picsum.photos/seed/${seed}/${w}/${h}`;

    status.innerText = "GEN🪄";
    img.classList.add('blur');

    try {
        const response = await fetch(hdUrl);
        const blob = await response.blob();
        
        if (currentBlobUrl) {
            URL.revokeObjectURL(currentBlobUrl);
        }

        currentBlobUrl = URL.createObjectURL(blob);
        
        img.src = currentBlobUrl; 
        img.onload = () => {
            img.classList.remove('blur');
            status.innerText = `DONE✨`;
        };
    } catch (error) {
        console.error("Fetch failed", error);
        status.innerText = "SYS_ERROR";
    }
}

function downloadWall() {
    if(!currentBlobUrl) return;
    const btn = document.querySelector('.save-pill');
    btn.innerText = "...";

    const a = document.createElement('a');
    a.href = currentBlobUrl;
    a.download = `NothingSpace_${currentMode}_${Date.now()}.jpg`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    setTimeout(() => {
        btn.innerText = "SAVE";
    }, 1000);
}

   /* ================= MUSIC MODULE ================= */
let currentAudioBlobUrl = null; 

async function searchMusic() {
    const query = document.getElementById('mQuery').value; 
    const btn = document.getElementById('mSearchBtn'); 
    const card = document.getElementById('music-card');
    
    if (!query) return; 
    const originalBtn = btn.innerHTML; 
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
    
    try {
        const _0x1 = "aHR0cHM6Ly9pdHVuZXMuYXBwbGUuY29tL3NlYXJjaD9saW1pdD0yNTAmZW50aXR5PXNvbmcmdGVybT0="; 
        const res = await fetch(`${atob(_0x1)}${encodeURIComponent(query)}`); 
        const data = await res.json();
        
        if (data.results.length > 0) { 
            currentPlaylist = data.results.map(song => ({ 
                url: song.previewUrl, 
                art: song.artworkUrl100.replace('100x100', '400x400'), 
                title: song.trackName.replace(/mzaf_\d+/g, "Nothing TRACK").toUpperCase(), 
                artist: song.artistName
            })); 
            currentIndex = 0; 
            card.style.display = "block"; 
            loadSong(0); 
        } else {
            alert("Nothing FOUND");
        }
    } catch (e) { 
        console.error(e); 
    } finally { 
        btn.innerHTML = originalBtn; 
    }
}

async function loadSong(index) {
    if (!currentPlaylist[index]) return; 
    const song = currentPlaylist[index]; 
    const player = document.getElementById('mPlayer');
    
    document.getElementById('mArt').src = song.art; 
    document.getElementById('mTitle').innerText = song.title; 
    document.getElementById('mArtist').innerText = song.artist; 
    lastPlayedArt = song.art; 
    
    if(document.getElementById('mini-art')) {
        document.getElementById('mini-art').src = lastPlayedArt; 
    }
    
    if (currentAudioBlobUrl) {
        URL.revokeObjectURL(currentAudioBlobUrl);
        currentAudioBlobUrl = null;
    }

    try {
        const response = await fetch(song.url);
        const blob = await response.blob();
        currentAudioBlobUrl = URL.createObjectURL(blob);
        
        player.src = currentAudioBlobUrl; 
        player.load(); 
        togglePlay(true);
    } catch (error) {
        player.src = song.url; 
        player.load();
        togglePlay(true);
    }

    if ('mediaSession' in navigator) { 
        navigator.mediaSession.metadata = new MediaMetadata({ 
            title: song.title, 
            artist: song.artist, 
            album: "Nothing Space", 
            artwork: [{ src: song.art, sizes: '512x512', type: 'image/jpeg' }] 
        }); 
        navigator.mediaSession.setActionHandler('play', function() { togglePlay(true); }); 
        navigator.mediaSession.setActionHandler('pause', function() { togglePlay(false); }); 
        navigator.mediaSession.setActionHandler('previoustrack', prevSong); 
        navigator.mediaSession.setActionHandler('nexttrack', nextSong); 
    }
}

function togglePlay(forcePlay = false) {
    const player = document.getElementById('mPlayer'); 
    const icon = document.querySelector('#play-pause i'); 
    const art = document.getElementById('mArt');
    
    if (player.paused || forcePlay) { 
        player.play().catch(()=>{}); 
        icon.className = "fa-solid fa-circle-pause"; 
        art.classList.add('spinning'); 
        if('mediaSession' in navigator) navigator.mediaSession.playbackState = "playing"; 
    } else { 
        player.pause(); 
        icon.className = "fa-solid fa-circle-play"; 
        art.classList.remove('spinning'); 
        if('mediaSession' in navigator) navigator.mediaSession.playbackState = "paused"; 
    }
}

function nextSong() { if(currentPlaylist.length) { currentIndex = (currentIndex + 1) % currentPlaylist.length; loadSong(currentIndex); } }
function prevSong() { if(currentPlaylist.length) { currentIndex = (currentIndex - 1 + currentPlaylist.length) % currentPlaylist.length; loadSong(currentIndex); } }

function handleMusicClose() { 
    closeScreen('musicScr'); 
    if (!document.getElementById('mPlayer').paused) { 
        document.getElementById('mini-player').style.display = 'block'; 
        document.getElementById('mini-art').src = lastPlayedArt; 
        document.getElementById('mini-art').classList.add('spinning'); 
    } 
}

function restorePlayer() { 
    document.getElementById('mini-player').style.display = 'none'; 
    openScreen('musicScr'); 
}

async function downloadCurrentSong() {
    const song = currentPlaylist[currentIndex]; 
    const btn = document.querySelector('#music-card .btn'); 
    if(!song) return; 
    
    btn.style.pointerEvents = "none"; 
    btn.innerText = "SAVING...";

    try { 
        let downloadLink = currentAudioBlobUrl;
        
        if(!downloadLink) {
            const response = await fetch(song.url); 
            const blob = await response.blob(); 
            downloadLink = window.URL.createObjectURL(blob); 
        }

        const a = document.createElement('a'); 
        a.href = downloadLink; 
        a.download = `${song.title.replace(/[^a-zA-Z0-9\s]/g, '').trim()} - NothingSpace.mp3`; 
        document.body.appendChild(a); 
        a.click(); 
        document.body.removeChild(a); 
        
        if(!currentAudioBlobUrl) window.URL.revokeObjectURL(downloadLink);
        
        btn.innerText = "DONE ✓"; 
    } catch (e) { 
        window.open(song.url, '_blank'); 
        btn.innerText = "OPENED"; 
    } 
    
    setTimeout(() => { 
        btn.innerText = "DOWNLOAD"; 
        btn.style.pointerEvents = "all"; 
    }, 2000); 
}


/* ================= SETUP MODULE ================= */
    
    const GH_USER = "nothingcommunity";
    const GH_REPO = "Testing";
    const DB_FILE = "setups.json"; 
    
    const P1 = "ghp_DVfuzTC01Wg0"; 
    const P2 = "X4jx2S7my7sTMRWFOe2y3Lsn";
    const GH_TOKEN = P1 + P2;

    async function uploadToGitHub(base64Img, filename) {
        if (!base64Img) return null;
        const content = base64Img.split(',')[1];
        const cleanFileName = `${Date.now()}_${filename.replace(/\s/g, '_')}`;
        const apiUrl = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/2026_feb/${cleanFileName}`;

        try {
            const res = await fetch(apiUrl, {
                method: 'PUT',
                headers: { 'Authorization': `token ${GH_TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: "Upload Image", content: content })
            });
            if (res.ok) return `https://raw.githubusercontent.com/${GH_USER}/${GH_REPO}/main/2026_feb/${cleanFileName}`;
        } catch (e) { console.error("Upload Error:", e); }
        return null;
    }

    async function updateGitHubDatabase(action, payload) {
        const apiUrl = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/${DB_FILE}`;
        let currentData = [];
        let sha = null; 

        try {
            const getRes = await fetch(apiUrl + `?t=${Date.now()}`, { 
                headers: { 'Authorization': `token ${GH_TOKEN}` } 
            });
            if (getRes.ok) {
                const json = await getRes.json();
                sha = json.sha;
                const decodedContent = new TextDecoder().decode(Uint8Array.from(atob(json.content), c => c.charCodeAt(0)));
                currentData = JSON.parse(decodedContent);
            }
        } catch (e) { console.error("DB Init Error"); }

        if (action === 'ADD') {
            currentData.push(payload);
        } 
        else if (action === 'LIKE') {
            const index = currentData.findIndex(x => x.id === payload.id);
            if (index !== -1) currentData[index].likes = (currentData[index].likes || 0) + 1;
        } 
        else if (action === 'DELETE') {
            currentData = currentData.filter(x => x.id !== payload.id);
        }

        const updatedContent = btoa(unescape(encodeURIComponent(JSON.stringify(currentData, null, 2))));

        await fetch(apiUrl, {
            method: 'PUT',
            headers: { 'Authorization': `token ${GH_TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: `Action: ${action}`,
                content: updatedContent,
                sha: sha
            })
        });
    }

    async function submitSetup() {
        const title = document.getElementById('setupTitle').value;
        const btn = document.getElementById('submitBtn');

        if(!title || !imgStore.ssLock || !imgStore.ssHome || !imgStore.wallLock || !imgStore.wallHome) {
            alert("⚠️ Please select all 4 images!"); return;
        }

        btn.innerText = "UPLOADING..."; btn.style.pointerEvents = "none";

        try {
            const u1 = await uploadToGitHub(imgStore.ssLock, "lock_ss.jpg");
            const u2 = await uploadToGitHub(imgStore.ssHome, "home_ss.jpg");
            const u3 = await uploadToGitHub(imgStore.wallLock, "lock_wall.jpg");
            const u4 = await uploadToGitHub(imgStore.wallHome, "home_wall.jpg");

            if(!u1 || !u2 || !u3 || !u4) throw new Error("GitHub Upload Failed");

            if (!savedName || savedName === "USER") { 
                let n = prompt("ENTER YOUR NAME:"); 
                savedName = n ? n.toUpperCase() : "USER"; 
                localStorage.setItem('ns_user_fixed', savedName); 
            }
            
            const newSetup = {
                id: "id_" + Date.now(),
                title: title.toUpperCase(),
                desc: document.getElementById('setupDesc').value,
                ssLock: u1, ssHome: u2, wallLock: u3, wallHome: u4,
                likes: 0,
                uuid: userUUID,
                author: savedName,
                date: Date.now()
            };

            await updateGitHubDatabase('ADD', newSetup);
            alert("Posted successfully 🎉 ,⏳ It will automatically appear on the website in a few minutes.!");
            location.reload();

        } catch(e) {
            alert("Error: " + e.message);
            btn.innerText = "POST NOW"; btn.style.pointerEvents = "all";
        }
    }

    async function loadSetups() {
        const grid = document.getElementById('setupGrid');
        const modal = document.querySelector('#setupScr .modal');
        grid.innerHTML = "<p style='text-align:center; opacity:0.5;'>LOADING FEEDS...</p>";

        try {
            const rawUrl = `https://raw.githubusercontent.com/${GH_USER}/${GH_REPO}/main/${DB_FILE}?t=${Date.now()}`;
            const res = await fetch(rawUrl);
            if(!res.ok) throw new Error();
            
            let list = await res.json();

            list.sort((a, b) => {
                const likesA = Math.max(a.likes || 0, parseInt(localStorage.getItem('count_' + a.id) || 0));
                const likesB = Math.max(b.likes || 0, parseInt(localStorage.getItem('count_' + b.id) || 0));
                if (likesB !== likesA) return likesB - likesA; 
                return (b.date || 0) - (a.date || 0); 
            });

            grid.innerHTML = list.map(p => {
                const isLiked = localStorage.getItem('l_' + p.id);
                let showLikes = p.likes || 0;
                const localCount = localStorage.getItem('count_' + p.id);
                if (localCount && parseInt(localCount) > showLikes) showLikes = parseInt(localCount);

                const isMine = (p.uuid === userUUID); 
                const isAdmin = (typeof ADMIN_UUID !== 'undefined' && userUUID === ADMIN_UUID);
                
                const showDelete = isMine || isAdmin;

                return `
                <div class="setup-card">
                    <div class="setup-header">
                        <h3>${p.title}</h3>
                        <span style="opacity:0.5; font-size:0.8rem; border:1px solid #333; padding:2px 6px; border-radius:4px;">${p.author}</span>
                    </div>
                    <div class="phone-showcase">
                        <div class="phone-frame" onclick="selectFrame(this, '${p.wallHome}', '${p.title}_HOME')"><img src="${p.ssHome}"></div>
                        <div class="phone-frame" onclick="selectFrame(this, '${p.wallLock}', '${p.title}_LOCK')"><img src="${p.ssLock}"></div>
                    </div>
                    
                    <button class="dl-btn" onclick="forceDownload(this.dataset.url, this.dataset.name)" data-url="" data-name="">
                        DOWNLOAD WALLPAPER
                    </button>
                    
                    <p style="margin:15px 0 10px; opacity:0.8; font-size:0.9rem;">${p.desc || ''}</p>
                    
                    <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid #222; padding-top:15px;">
                        <button class="like-btn ${isLiked ? 'liked' : ''}" onclick="doLike('${p.id}', ${showLikes}, this)">
                            <i class="fa-solid fa-heart"></i> <span>${showLikes}</span>
                        </button>
                        
                        ${showDelete ? `
                            <div onclick="deleteSetup('${p.id}', '${p.uuid}')" style="cursor:pointer; padding:8px; background:rgba(255,0,0,0.1); border-radius:8px;">
                                <i class="fa-solid fa-trash" style="color:#ff4444;"></i>
                            </div>` 
                        : ''}
                    </div>
                </div>`;
            }).join('');

            setTimeout(() => { if(typeof attachFocusScroll === "function") attachFocusScroll(modal); }, 200);

        } catch(e) { grid.innerHTML = "<p style='text-align:center; opacity:0.5;'>NO SETUPS FOUND</p>"; }
    }

    async function deleteSetup(id, postUUID) {
        const isMine = postUUID === userUUID;
        const isAdmin = (typeof ADMIN_UUID !== 'undefined' && userUUID === ADMIN_UUID);

        if (isAdmin) {
             const pass = prompt("ADMIN PASSWORD:");
             if (pass === "465630") { 
                await performDelete(id);
             } else {
                alert("WRONG PASSWORD");
             }
        } else if (isMine) {
            if(confirm("DELETE YOUR SETUP?")) {
                await performDelete(id);
            }
        }
    }

    async function performDelete(id) {
        document.getElementById('setupGrid').innerHTML = "<p style='text-align:center'>DELETING...</p>";
        
        try {
            await updateGitHubDatabase('DELETE', { id: id });
            alert("Deleted successfully 😢 ,⏳ It will automatically disappear on the website in a few minutes!");
          loadSetups(); 
        } catch(e) {
            alert("Delete Failed: " + e.message);
            loadSetups();
        }
    }

    function handleImg(input, prevId, isScreen) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image(); img.src = e.target.result;
                img.onload = function() {
                    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                    const maxWidth = isScreen ? 400 : 1080; const scale = maxWidth / img.width;
                    canvas.width = maxWidth; canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const res = canvas.toDataURL('image/jpeg', 0.7);
                    if(prevId === 'prevSsLock') imgStore.ssLock = res;
                    if(prevId === 'prevSsHome') imgStore.ssHome = res;
                    if(prevId === 'prevWallLock') imgStore.wallLock = res;
                    if(prevId === 'prevWallHome') imgStore.wallHome = res;
                    document.getElementById(prevId).innerHTML = `<img src="${res}" style="width:100%; height:100%; object-fit:contain;">`;
                }
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function selectFrame(frame, wallUrl, name) {
        const isAlreadyActive = frame.classList.contains('active');
        document.querySelectorAll('.phone-frame').forEach(f => f.classList.remove('active'));
        document.querySelectorAll('.dl-btn').forEach(b => b.style.display = 'none');
        if (!isAlreadyActive) {
            frame.classList.add('active');
            const card = frame.closest('.setup-card');
            const btn = card.querySelector('.dl-btn');
            if(btn) {
                btn.style.display = 'block';
                btn.dataset.url = wallUrl;
                btn.dataset.name = name + ".jpg";
            }
        }
    }

    async function forceDownload(url, filename) {
        if(!url) return;
        const btn = event.target;
        const oldText = btn.innerText;
        btn.innerText = "DOWNLOADING...";
        btn.style.pointerEvents = "none";
        try {
            const response = await fetch(url);
            const blob = await response.blob();
            const blobUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = blobUrl; a.download = filename;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            window.URL.revokeObjectURL(blobUrl);
            btn.innerText = "SAVED ✓";
        } catch (e) { window.open(url, '_blank'); btn.innerText = "OPENED"; }
        setTimeout(() => { btn.innerText = oldText; btn.style.pointerEvents = "all"; }, 2000);
    }

    async function doLike(id, currentLikes, btn) {
        if(localStorage.getItem('l_' + id)) return; 
        const newCount = parseInt(currentLikes) + 1;
        localStorage.setItem('l_' + id, '1');
        localStorage.setItem('count_' + id, newCount); 
        btn.classList.add('liked');
        btn.querySelector('span').innerText = newCount;
        updateGitHubDatabase('LIKE', { id: id }).catch(e => console.error("Sync Error"));
    }
    
    function attachFocusScroll(modal) {
        if(!modal) return;
        const handleScroll = () => {
            const cards = document.querySelectorAll('.setup-card');
            const modalCenter = modal.getBoundingClientRect().top + (modal.clientHeight / 2);
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const cardCenter = rect.top + (rect.height / 2);
                const dist = Math.abs(modalCenter - cardCenter);
                if (dist < 200) card.classList.add('in-focus');
                else card.classList.remove('in-focus');
            });
        };
        modal.removeEventListener('scroll', handleScroll); 
        modal.addEventListener('scroll', handleScroll);
        handleScroll();
    }
    function toggleItem(element) {
    const content = element.nextElementSibling;
    content.classList.toggle('open');
    if(navigator.vibrate) navigator.vibrate(10);
}

/* ================= COMMUNITY PROJECTS ENGINE ================= */

const PRJ_GH_U = "nothingcommunity";
const PRJ_GH_R = "Testing";
const PRJ_GH_DB = "projects.json";

const PRJ_T1 = "ghp_DVfuzTC01Wg0"; 
const PRJ_T2 = "X4jx2S7my7sTMRWFOe2y3Lsn";
const PRJ_TOKEN = PRJ_T1 + PRJ_T2;

let prjStore = { avatar: null, img1: null, img2: null, img3: null };

async function getPrjDB() {
    const url = `https://api.github.com/repos/${PRJ_GH_U}/${PRJ_GH_R}/contents/${PRJ_GH_DB}`;
    try {
        const res = await fetch(url + `?t=${Date.now()}`, { headers: { 'Authorization': `token ${PRJ_TOKEN}` } });
        if (res.ok) {
            const json = await res.json();
            const content = decodeURIComponent(escape(atob(json.content)));
            return { sha: json.sha, data: JSON.parse(content) };
        }
    } catch(e) { console.error("DB Error", e); }
    return { sha: null, data: [] };
}

async function savePrjDB(data, sha, msg) {
    const url = `https://api.github.com/repos/${PRJ_GH_U}/${PRJ_GH_R}/contents/${PRJ_GH_DB}`;
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
    await fetch(url, {
        method: 'PUT', headers: { 'Authorization': `token ${PRJ_TOKEN}`, 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg, content: content, sha: sha })
    });
}

async function uploadPrjImg(base64, namePrefix) {
    if(!base64) return null;
    const content = base64.split(',')[1];
    const filename = `PRJ_${Date.now()}_${namePrefix}.jpg`;
    const url = `https://api.github.com/repos/${PRJ_GH_U}/${PRJ_GH_R}/contents/Projects/${filename}`;
    try {
        const res = await fetch(url, {
            method: 'PUT', headers: { 'Authorization': `token ${PRJ_TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Img Upload", content: content })
        });
        if(res.ok) return `https://raw.githubusercontent.com/${PRJ_GH_U}/${PRJ_GH_R}/main/Projects/${filename}`;
    } catch(e) { console.error(e); }
    return null;
}

function openProjectScreen() {
    const s = document.getElementById('projectScr');
    if(s) {
        s.style.display = 'flex';
        setTimeout(() => s.classList.add('active'), 10);
        loadPrjFeed(); 
    }
}

function switchProjectTab(tab) {
    const feed = document.getElementById('projectFeed');
    const form = document.getElementById('projectForm');
    const b1 = document.getElementById('btnFeed');
    const b2 = document.getElementById('btnUpload');

    if(tab === 'feed') {
        if(b1 && b1.classList.contains('active')) return;
        feed.style.display = 'block'; form.style.display = 'none';
        if(b1) b1.classList.add('active'); if(b2) b2.classList.remove('active');
        loadPrjFeed(); 
    } else {
        feed.style.display = 'none'; form.style.display = 'block';
        if(b2) b2.classList.add('active'); if(b1) b1.classList.remove('active');
    }
}

function handlePrjFile(input, prvId, key) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            prjStore[key] = e.target.result;
            if(key === 'avatar') {
                document.getElementById('pfpPrv').src = e.target.result;
                document.getElementById('pfpPrv').style.display = 'block';
                document.getElementById('pfpIcon').style.display = 'none';
            } else {
                document.getElementById(prvId).innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">`;
            }
        }
        reader.readAsDataURL(input.files[0]);
    }
}

async function loadPrjFeed() {
    const feed = document.getElementById('projectFeed');
    
    const cachedData = localStorage.getItem('prj_cache');
    if (cachedData) {
        renderProjects(JSON.parse(cachedData));
    } else {
        feed.innerHTML = "<p style='text-align:center; padding:20px; opacity:0.5;'>FETCHING PROJECTS...</p>";
    }

    try {
        const res = await fetch(`https://raw.githubusercontent.com/${PRJ_GH_U}/${PRJ_GH_R}/main/${PRJ_GH_DB}?t=${Date.now()}`);
        if(!res.ok) throw new Error();
        let data = await res.json();
        
        localStorage.setItem('prj_cache', JSON.stringify(data));
        renderProjects(data);
    } catch(e) { 
        if(!cachedData) feed.innerHTML = "<p style='text-align:center; opacity:0.5;'>ERROR LOADING FEED</p>"; 
    }
}

function renderProjects(data) {
    const feed = document.getElementById('projectFeed');
    if(!data || data.length === 0) { 
        feed.innerHTML = "<p style='text-align:center; opacity:0.5;'>NO PROJECTS YET</p>"; 
        return; 
    }

    feed.innerHTML = data.reverse().map(p => {
        const pfp = p.avatar || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        const tick = p.verified ? `<i class="fa-solid fa-circle-check" style="color:#3b82f6; margin-left:5px;"></i>` : ``;

        const isMine = (p.uuid === userUUID); 
        const isAdmin = (typeof ADMIN_UUID !== 'undefined' && userUUID === ADMIN_UUID);
        
        let controls = "";
        if (isMine || isAdmin) {
            controls += `<button onclick="deleteProject('${p.id}', '${p.uuid}')" style="background:rgba(255,0,0,0.1); color:#ff4444; border:none; padding:6px 12px; border-radius:6px; font-size:0.75rem; cursor:pointer;"><i class="fa-solid fa-trash"></i> DELETE</button>`;
        }
        if (isAdmin) {
            controls += `<button onclick="toggleVerifyProject('${p.id}')" style="background:rgba(0,218,255,0.1); color:#00daff; border:none; padding:6px 12px; border-radius:6px; font-size:0.75rem; cursor:pointer; margin-left:8px;"><i class="fa-solid fa-shield-check"></i> ${p.verified ? 'UNVERIFY' : 'VERIFY'}</button>`;
        }

        let imgs = "";
        if(p.images && p.images.length > 0) {
            imgs = `<div class="p-imgs" style="display:flex; gap:8px; overflow-x:auto; margin:12px 0; padding-bottom:5px;">
                ${p.images.map(url => `<img src="${url}" style="height:110px; border-radius:10px; object-fit:cover; pointer-events:none;">`).join('')}
            </div>`;
        }

        let actionBtn = "";
        if (p.link) {
            if (p.verified) {
                actionBtn = `<a href="${p.link}" target="_blank" style="color:var(--card); text-decoration:none; background:var(--text); padding:6px 14px; border-radius:20px; font-size:0.8rem; border:1px solid #333;">GET PROJECT</a>`;
            } else {
                actionBtn = `<span onclick="alert('🔒 Project is under verification! Please wait for Admin approval.')" style="cursor:pointer; opacity:0.6; color:var(--card); background:var(--text); padding:6px 14px; border-radius:20px; font-size:0.8rem; border:1px solid #333;">GET PROJECT 🔒</span>`;
            }
        }

        return `
        <div class="project-card" style="background:var(--card); padding:16px; border-radius:18px; margin-bottom:16px; border:1px solid var(--border);">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
                <img src="${pfp}" style="width:42px; height:42px; border-radius:50%; border:1px solid var(--border); object-fit:cover;">
                <div>
                    <h3 style="margin:0; font-size:1.35rem; color:var(--text); letter-spacing:0.4px;">${p.title}${tick} </h3>
                    <span style="font-size:0.8rem; color:#777;">DEV : ${p.author}</span>
                </div>
            </div>
            <p style="color:#bbb; font-size:0.9rem; line-height:1.2; margin:0;">${p.desc}</p>
            ${imgs}
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px; border-top:1px solid var(--border); padding-top:12px;">
                ${actionBtn}
                <div style="display:flex;">${controls}</div>
            </div>
        </div>`;
    }).join('');
}

async function pushProjectData() {
    const author = document.getElementById('prjAuthor').value;
    const title = document.getElementById('prjTitle').value;
    const desc = document.getElementById('prjDesc').value;
    const link = document.getElementById('prjUrl').value;
    const btn = document.getElementById('prjPushBtn');
    const txt = btn.querySelector('.btn-text');
    const bar = btn.querySelector('.progress-bar');

    if(!author || !title || !prjStore.img1) { alert("⚠️ NAME, TITLE & 1 IMAGE REQUIRED!"); return; }

    btn.style.pointerEvents = "none"; txt.innerText = "UPLOADING..."; bar.style.width = "30%";

    try {
        const uAv = await uploadPrjImg(prjStore.avatar, "pfp");
        const u1 = await uploadPrjImg(prjStore.img1, "s1");
        bar.style.width = "60%";
        const u2 = await uploadPrjImg(prjStore.img2, "s2");
        const u3 = await uploadPrjImg(prjStore.img3, "s3");
        
        const { sha, data } = await getPrjDB();
        const newPost = {
            id: "prj_" + Date.now(),
            uuid: userUUID, 
            title: title.toUpperCase(), author: author.toUpperCase(),
            avatar: uAv, desc: desc, link: link, images: [u1, u2, u3].filter(x => x),
            verified: false, date: Date.now()
        };
        data.push(newPost);
        await savePrjDB(data, sha, `Hub: ${title}`);
        bar.style.width = "100%"; txt.innerText = "SUCCESS!"; 
        alert("Project Published 🎉 ,⏳ It will automatically appear on the website in a few minutes.!");
        location.reload();
    } catch(e) { 
        alert("Error: " + e.message); btn.style.pointerEvents = "all"; bar.style.width = "0%"; txt.innerText = "RETRY"; 
    }
}


async function deleteProject(id, postUUID) {
    const isMine = postUUID === userUUID;
    const isAdmin = (typeof ADMIN_UUID !== 'undefined' && userUUID === ADMIN_UUID);
    
    if (!isMine && !isAdmin) return;

    if (confirm("Want to delete this project?😢")) {
        
        let localData = [];
        try { localData = JSON.parse(localStorage.getItem('prj_cache') || "[]"); } catch(e){}

        const newData = localData.filter(x => x.id !== id);
        
        localStorage.setItem('prj_cache', JSON.stringify(newData));
        renderProjects(newData);
        
        setTimeout(() => {
             alert("🗑️ PROJECT DELETED SUCCESSFULLY! ⏳ It will disappear from server shortly.");
        }, 50);

        try {
            const { sha, data } = await getPrjDB();
            const filtered = data.filter(x => x.id !== id);
            await savePrjDB(filtered, sha, "Project Removed");
        } catch(e) {
            console.error("Server sync failed, but local is updated.");
        }
    }
}

async function toggleVerifyProject(id) {
    if (typeof ADMIN_UUID === 'undefined' || userUUID !== ADMIN_UUID) return;

    let localData = [];
    try { localData = JSON.parse(localStorage.getItem('prj_cache') || "[]"); } catch(e){}
    
    const idx = localData.findIndex(x => x.id === id);
    if(idx === -1) return;

    const currentStatus = localData[idx].verified;
    const actionName = currentStatus ? "UNVERIFY" : "VERIFY";

    if (confirm(`🛡️ DO YOU WANT TO ${actionName} THIS PROJECT?`)) {

        localData[idx].verified = !currentStatus;
        localStorage.setItem('prj_cache', JSON.stringify(localData));
        renderProjects(localData);

        setTimeout(() => {
            alert(`✅ PROJECT ${actionName}ED!`);
        }, 50);

        try {
            const { sha, data } = await getPrjDB();
            const serverIdx = data.findIndex(x => x.id === id);
            if(serverIdx > -1) {
                data[serverIdx].verified = localData[idx].verified;
                await savePrjDB(data, sha, "Verify Status Updated");
            }
        } catch(e) { console.error("Server sync failed."); }
    }
}
    /* ================= CHAT MODULE ================= */
    let userUUID = localStorage.getItem('ns_user_uuid');
    if (!userUUID) { userUUID = 'uid_' + Date.now().toString(36) + Math.random().toString(36).substr(2); localStorage.setItem('ns_user_uuid', userUUID); }
    let savedName = localStorage.getItem('ns_user_fixed') || "";
    let selectedImgBase64 = "";

    async function checkVerifyStatus() {
        try {
            const res = await fetch("https://nothingcommunity-7664f-default-rtdb.firebaseio.com/verified_users.json");
            const v = await res.json() || {};
            if(v[userUUID] === true) {
                document.getElementById('imgUploadBtn').style.display = 'block';
            } else {
                document.getElementById('imgUploadBtn').style.display = 'none';
            }
        } catch(e) {}
    }

    function handleFileSelect() {
        const fileInput = document.getElementById('imgInput');
        const file = fileInput.files[0];
        if (!file) return;

        fetch("https://nothingcommunity-7664f-default-rtdb.firebaseio.com/verified_users.json")
        .then(res => res.json())
        .then(verifiedList => {
            verifiedList = verifiedList || {};
            if (verifiedList[userUUID] !== true) {
                alert("🔒 ONLY VERIFIED USERS CAN SEND PHOTOS.");
                fileInput.value = "";
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.src = e.target.result;
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 800; 
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    selectedImgBase64 = canvas.toDataURL('image/jpeg', 0.7); 
                    const preview = document.getElementById('imgPreview');
                    preview.src = selectedImgBase64;
                    preview.style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
        })
        .catch(() => {
            alert("ERROR CHECKING PERMISSIONS");
            fileInput.value = "";
        });
    }
    function clearImage() { document.getElementById('imgInput').value = ""; document.getElementById('imgPreview').style.display = 'none'; selectedImgBase64 = ""; }
    
    function initReply(id, name, text) {
        currentReply = { id: id, name: name, text: text };
        document.getElementById('replyBanner').style.display = 'flex';
        document.getElementById('replyText').innerText = name + ": " + text;
        document.getElementById('userMsg').focus();
    }

    function cancelReply() {
        currentReply = null;
        document.getElementById('replyBanner').style.display = 'none';
    }

    function scrollToMsg(id) {
        const target = document.getElementById(`msg-${id}`);
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            target.style.transition = "background 0.5s ease";
            const originalBg = target.style.background;
            target.style.background = "rgba(255, 0, 0, 0.2)"; 
            setTimeout(() => { target.style.background = originalBg; }, 1000);
        } else {
            alert("Message not found (might be deleted or not loaded).");
        }
    }

    async function sendMsg() {
        const input = document.getElementById('userMsg'); const btn = document.getElementById('sendBtn'); 
        let msg = input.value.trim();
        
        if (!msg && !selectedImgBase64) return;
        if (msg === "/reset") { localStorage.removeItem('ns_user_fixed'); savedName = ""; alert("NAME RESET!"); input.value = ""; return; }
        if (!savedName || savedName === "USER") { let enterName = prompt("ENTER YOUR NAME:"); if (!enterName || enterName.trim() === "") return; savedName = enterName.trim().toUpperCase(); localStorage.setItem('ns_user_fixed', savedName); }
        
        const payload = { 
            userName: savedName, 
            text: msg, 
            image: selectedImgBase64, 
            reply: "", 
            timestamp: Date.now(), 
            uuid: userUUID, 
            isVerified: false,
            quoted: currentReply ? { id: currentReply.id, name: currentReply.name, text: currentReply.text } : null 
        };

        const originalHTML = btn.innerHTML; btn.disabled = true; btn.innerHTML = '<span class="red-dot-loader"></span>';
        try {
            const banCheck = await fetch(`https://nothingcommunity-7664f-default-rtdb.firebaseio.com/banned/${userUUID}.json`); const isBanned = await banCheck.json(); if (isBanned === true) { alert("🚫 YOU ARE BANNED."); return; }
            await fetch(DB_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); 
            input.value = ""; clearImage(); cancelReply(); await loadMessages(); 
        } catch (e) { alert("FAILED"); } finally { btn.disabled = false; btn.innerHTML = originalHTML; }
    }

    function toggleMsgActions(bubble) {
        const isActive = bubble.classList.contains('active-actions');
        document.querySelectorAll('.msg-bubble').forEach(b => b.classList.remove('active-actions'));
        if(!isActive) bubble.classList.add('active-actions');
    }

    async function deleteMyMsg(id) {
        if(!confirm("DELETE?")) return;
        try {
            await fetch(`https://nothingcommunity-7664f-default-rtdb.firebaseio.com/chat/${id}.json`, { method: 'DELETE' });
            loadMessages();
        } catch(e) { alert("ERROR"); }
    }

    async function loadMessages() {
        try {
            const [chatRes, verifyRes] = await Promise.all([ fetch(DB_URL), fetch("https://nothingcommunity-7664f-default-rtdb.firebaseio.com/verified_users.json") ]);
            const data = await chatRes.json(); const verifiedData = await verifyRes.json() || {}; const board = document.getElementById('msgBoard');
            if (!data) { board.innerHTML = '<p style="opacity:0.4; text-align:center;">NO MESSAGES YET.</p>'; return; }
            const messages = Object.keys(data).map(key => ({ id: key, ...data[key] }));
            
            board.innerHTML = messages.map(m => {
                const isUserVerified = (m.uuid && verifiedData[m.uuid] === true);
                const tickHtml = isUserVerified ? '<i class="fa-solid fa-circle-check" style="color:#1da1f2; margin-left:4px; font-size:0.8rem;"></i>' : '';
                const isMe = m.uuid === userUUID; const alignClass = isMe ? 'self' : '';
                const deleteBtn = isMe ? `<span class="action-btn del-btn" onclick="event.stopPropagation(); deleteMyMsg('${m.id}')"><i class="fa-solid fa-trash"></i> DELETE</span>` : '';
                
                let quotedHtml = ''; 
                if (m.quoted) { 
                    const replyId = m.quoted.id || ''; 
                    const clickAction = replyId ? `onclick="event.stopPropagation(); scrollToMsg('${replyId}')"` : '';
                    quotedHtml = `<div class="quoted-block" ${clickAction} style="${replyId ? 'cursor:pointer;' : ''}">
                                        <span class="q-name">${m.quoted.name}</span>
                                        <span class="q-text">${m.quoted.text}</span>
                                      </div>`; 
                }

                return `
                <div id="msg-${m.id}" class="msg-bubble ${alignClass}" style="user-select: none;" 
                     onclick="toggleMsgActions(this)">
                    
                    <span class="u-badge" onclick="handleAdminTap(event, '${m.id}', '${m.userName}', ${isUserVerified}, '${m.uuid}')">
                        ${m.userName || 'USER'} ${tickHtml}
                    </span>

                    ${quotedHtml}
                    ${m.image ? `<img src="${m.image}" class="msg-img" onclick="openImageViewer(this.src)">` : ''}
                    
                    <p style="text-transform:none; margin:5px 0;">${m.text}</p>

                    ${m.reply ? `<div class="admin-reply-box"><span class="admin-tag">● ADMIN REPLY</span><p style="text-transform:none; opacity:0.8;">${m.reply}</p></div>` : ''}
                    
                    <div class="msg-footer">
                        <span class="action-btn" onclick="event.stopPropagation(); initReply('${m.id}', '${m.userName}', '${m.text.replace(/'/g, "\\'")}')">
                            <i class="fa-solid fa-reply"></i> REPLY
                        </span>
                        ${deleteBtn}
                    </div>
                </div>`;
            }).join(''); board.scrollTop = board.scrollHeight;
        } catch (e) { console.log(e); }
    }

    let adminTapCount = 0;
    let adminTapTimer;

    function handleAdminTap(event, id, name, verified, uuid) {
        event.stopPropagation(); 

        if (userUUID !== ADMIN_UUID) return;

        adminTapCount++;
        
        clearTimeout(adminTapTimer);

        if (adminTapCount === 2) {
            adminTapCount = 0; 
            if (navigator.vibrate) navigator.vibrate([50, 50, 50]); 
            adminControl(id, name, verified, uuid); 
        } else {
            adminTapTimer = setTimeout(() => {
                adminTapCount = 0;
            }, 400);
        }
    }

    async function adminControl(msgId, currentName, currentStatus, targetUUID) {
        const pass = prompt("ADMIN PASSWORD:"); if (!pass) return;
        if (stringToHash(pass) === "1540218370") {
            const action = prompt(`MANAGE: ${currentName}\nUUID: ${targetUUID ? 'FOUND' : 'MISSING'}\n\n1.REPLY 2.DELETE ALL 3.DELETE SINGLE 4.${currentStatus ? 'UNVERIFY' : 'VERIFY'} 5.BAN 6.UNBAN`);
            const url = `https://nothingcommunity-7664f-default-rtdb.firebaseio.com/chat/${msgId}.json`;
            const banUrl = `https://nothingcommunity-7664f-default-rtdb.firebaseio.com/banned/${targetUUID}.json`;
            const verifyUrl = `https://nothingcommunity-7664f-default-rtdb.firebaseio.com/verified_users/${targetUUID}.json`;
            
            if (action === "1") { const txt = prompt("REPLY:"); if(txt) await fetch(url, { method: 'PATCH', body: JSON.stringify({ reply: txt }) }); }
            else if (action === "2") { 
                if(targetUUID && confirm("⚠️ DELETE ALL MESSAGES FROM THIS USER?")) {
                    const allMsgRes = await fetch(DB_URL);
                    const allData = await allMsgRes.json();
                    if(allData) {
                        const promises = [];
                        Object.keys(allData).forEach(key => {
                            if(allData[key].uuid === targetUUID) {
                                promises.push(fetch(`https://nothingcommunity-7664f-default-rtdb.firebaseio.com/chat/${key}.json`, { method: 'DELETE' }));
                            }
                        });
                        await Promise.all(promises);
                        alert("ALL MESSAGES DELETED!");
                    }
                }
            }
            else if (action === "3") { if(confirm("DELETE THIS MESSAGE?")) await fetch(url, { method: 'DELETE' }); }
            else if (action === "4") { if (!targetUUID) { alert("NO UUID"); return; } if (currentStatus) { await fetch(verifyUrl, { method: 'DELETE' }); alert("UNVERIFIED"); } else { await fetch(verifyUrl, { method: 'PUT', body: JSON.stringify(true) }); alert("VERIFIED"); } }
            else if (action === "5") { if(targetUUID && confirm("BAN?")) { await fetch(banUrl, { method: 'PUT', body: JSON.stringify(true) }); alert("BANNED"); } }
            else if (action === "6") { if(targetUUID) { await fetch(banUrl, { method: 'DELETE' }); alert("UNBANNED"); } }
            loadMessages();
        } else alert("WRONG PASSWORD!");
    }

    function stringToHash(string) { let hash = 0; if (string.length === 0) return hash; for (let i = 0; i < string.length; i++) { const char = string.charCodeAt(i); hash = ((hash << 5) - hash) + char; hash = hash & hash; } return hash.toString(); }
    async function initPresetData() { const grid = document.getElementById('presetGrid'); grid.innerHTML = "<p style='padding:20px; text-align:center;'>LOADING PRESETS...</p>"; try { const res = await fetch("https://raw.githubusercontent.com/nothingtools/nothingtools.github.io/main/camera%20preset/preset.json"); const data = await res.json(); grid.innerHTML = data.map(p => `<div class="wp-card"><img src="${p.img}" loading="lazy" width="200" height="250"><div class="wp-overlay"><p>${p.id || 'PRESET'}</p><button class="btn" onclick="runDownload(this, '${p.url}')"><div class="progress-bar"></div><span class="btn-text">GET</span></button></div></div>`).join(''); setTimeout(attachScrollAnimation, 100); } catch(e) { grid.innerHTML = "ERROR"; } }
    async function initWallpaperData() { const grid = document.getElementById('wallpaperGrid'); grid.innerHTML = "<p style='padding:20px; text-align:center;'>LOADING WALLPAPERS...</p>"; try { const res = await fetch("https://raw.githubusercontent.com/nothingcommunity/Testing/main/Wallpapers/Walls/wallpapers.json"); const data = await res.json(); const walls = Array.isArray(data) ? data : data.wallpapers; grid.innerHTML = walls.map(w => `<div class="wp-card"><img src="${w.img}" loading="lazy" width="200" height="250"><div class="wp-overlay"><button class="btn" onclick="runDownload(this, '${w.url}')"><div class="progress-bar"></div><span class="btn-text">DOWNLOAD</span></button></div></div>`).join(''); setTimeout(attachScrollAnimation, 100); } catch(e) { grid.innerHTML = "ERROR LOADING"; } }
    
    async function downloadAIWall(btn) { runDownload(btn, document.getElementById('aiImg').src); }

    function openImageViewer(src) {
        const viewer = document.getElementById('imgViewer');
        const img = document.getElementById('viewImg');
        img.src = src;
        viewer.style.display = 'flex';
        setTimeout(() => viewer.classList.add('active'), 10);
    }

    function closeImageViewer() {
        const viewer = document.getElementById('imgViewer');
        viewer.classList.remove('active');
        setTimeout(() => { viewer.style.display = 'none'; document.getElementById('viewImg').src = ""; }, 300);
    }

    function downloadViewImage() {
        const src = document.getElementById('viewImg').src;
        const a = document.createElement('a');
        a.href = src;
        a.download = "Nothing_Community_Img_" + Date.now() + ".jpg";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    document.addEventListener('contextmenu', function(e) { if (e.target.tagName === 'IMG') { e.preventDefault(); } }, false);

/* ================= SECRET FILE DROP LOGIC (TEXT + FILE FIXES) ================= */
let dropPeer = null;
let dropConn = null;
let directHtml5Qrcode = null; 
let resolveCurrentFile = null; 

let receiveBuffer = [];
let receivedSize = 0;
let expectedSize = 0;
let incomingFileInfo = null;
let statusTimeoutTimer = null; // Added to handle auto-hide timers

function initDropSystem(forceNew = false) {
    if (forceNew && dropPeer) {
        dropPeer.destroy();
        dropPeer = null;
    }
    
    if (dropPeer) return; 
    
    const randomId = Math.floor(10000000 + Math.random() * 90000000).toString();
    dropPeer = new Peer(randomId);

    dropPeer.on('open', (id) => {
        document.getElementById('dropMyCode').innerText = id;
        document.getElementById('dropQrCode').innerHTML = ""; 
        new QRCode(document.getElementById("dropQrCode"), {
            text: id, width: 160, height: 160, colorDark: "#000000", colorLight: "#ffffff"
        });
    });

    dropPeer.on('connection', (conn) => {
        if (dropConn) { conn.close(); return; }
        dropConn = conn; 
        
        conn.on('open', () => {
            if(navigator.vibrate) navigator.vibrate([30, 30]);
            document.getElementById('recvInitialUI').style.display = 'none';
            document.getElementById('recvConnectedUI').style.display = 'block';
            showDropStatus("SESSION LOCKED. WAITING... 🔒", "var(--text)", "radar", 0, false);
        });

        conn.on('data', (data) => {
            // NEW: TEXT HANDLING
            if (data.type === 'text') {
                if(navigator.vibrate) navigator.vibrate([30, 30]);
                appendReceivedText(data.content);
                showDropStatus("TEXT RECEIVED ✅", "#28a745", "none", 0, true);
            }
            // FILE HANDLING
            else if (data.type === 'header') {
                receiveBuffer = [];
                receivedSize = 0;
                expectedSize = data.size;
                incomingFileInfo = data;
                showDropStatus(`PREPARING FILE...`, "var(--text)", "progress", 0, false);
            } 
            else if (data.type === 'chunk') {
                receiveBuffer.push(data.data);
                receivedSize += data.data.byteLength;

                if (receivedSize === expectedSize || receiveBuffer.length % 5 === 0) {
                    let percent = Math.round((receivedSize / expectedSize) * 100);
                    showDropStatus(`DOWNLOADING: ${percent}%`, "var(--text)", "progress", percent, false);
                }

                if (receivedSize === expectedSize) {
                    if(navigator.vibrate) navigator.vibrate([50, 50]);
                    
                    const blob = new Blob(receiveBuffer, { type: incomingFileInfo.filetype });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a'); 
                    a.href = url; 
                    a.download = incomingFileInfo.filename; 
                    a.click();
                    
                    setTimeout(() => window.URL.revokeObjectURL(url), 5000);
                    conn.send({ type: 'ack' });
                    showDropStatus("FILE SAVED ✅", "#28a745", "none", 0, true);
                }
            }
        });
        
        conn.on('close', () => { disconnectDrop(true); });
    });
}

// Function to inject text neatly for the receiver
function appendReceivedText(text) {
    const container = document.getElementById('dropTextLogs');
    const safeText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    
    // Copy script injected into button
    const copyCode = `navigator.clipboard.writeText(this.previousElementSibling.innerText); this.innerHTML = '<i class=\\'fa-solid fa-check\\'></i>'; setTimeout(() => this.innerHTML = '<i class=\\'fa-regular fa-copy\\'></i>', 2000);`;
    
    const div = document.createElement('div');
    div.style.cssText = "background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 12px; border-radius: 12px; position: relative; word-wrap: break-word;";
    div.innerHTML = `
        <span style="display:block; font-family:'VT323', monospace; font-size:1.1rem; padding-right:35px; white-space: pre-wrap;">${safeText}</span>
        <button onclick="${copyCode}" style="position:absolute; right:8px; top:8px; background:var(--card); border:1px solid var(--border); color:var(--text); width:30px; height:30px; border-radius:8px; cursor:pointer;"><i class="fa-regular fa-copy"></i></button>
    `;
    container.prepend(div);
}

function switchDropTab(tab) {
    if(navigator.vibrate) navigator.vibrate(10);
    disconnectDrop(true);
    initDropSystem(true); 
    
    document.getElementById('recvTab').style.display = tab === 'recv' ? 'block' : 'none';
    document.getElementById('sendTab').style.display = tab === 'send' ? 'block' : 'none';
    
    if(tab === 'recv') stopDirectScanner();
}

// Auto Hide Logic added
function showDropStatus(msg, color, animType = "none", percent = 0, autoHide = false) {
    const d = document.getElementById('dropStatus');
    clearTimeout(statusTimeoutTimer); // Clear any existing hide timers

    d.style.display = 'block'; 
    d.style.color = color; 
    let animHtml = "";
    
    if (animType === "radar") {
        animHtml = `<div class="radar-box"><div class="radar-core"></div><div class="radar-pulse"></div></div>`;
    } else if (animType === "flow") {
        animHtml = `<div class="transfer-bar"><div class="transfer-flow"></div></div>`;
    } else if (animType === "progress") {
        animHtml = `
        <div style="width:100%; max-width:250px; height:8px; background:var(--border); border-radius:10px; margin:10px auto; overflow:hidden;">
            <div style="width:${percent}%; height:100%; background:var(--text); transition:width 0.1s ease-out;"></div>
        </div>`;
    }
    d.innerHTML = `${animHtml} <div style="margin-top:5px;">${msg}</div>`;

    // Automatically hide after 3 seconds if requested
    if (autoHide) {
        statusTimeoutTimer = setTimeout(() => {
            d.style.display = 'none';
        }, 3000);
    }
}

function startDirectScanner() {
    const trigger = document.getElementById('scannerTrigger');
    const reader = document.getElementById('dropReader');
    const loader = document.getElementById('scannerLoader');

    trigger.style.display = 'none';
    loader.style.display = 'block';

    if (!directHtml5Qrcode) {
        directHtml5Qrcode = new Html5Qrcode("dropReader");
    }

    const config = { fps: 10, qrbox: { width: 250, height: 250 } };

    directHtml5Qrcode.start({ facingMode: "environment" }, config,
        (decodedText) => {
            if(navigator.vibrate) navigator.vibrate(50);
            stopDirectScanner(); 
            connectDropManual(decodedText); 
        },
        (errorMessage) => {}
    ).then(() => {
        loader.style.display = 'none';
        reader.style.display = 'block';
    }).catch((err) => {
        loader.style.display = 'none';
        trigger.style.display = 'flex';
        alert("Camera access denied or error occurred.");
    });
}

function stopDirectScanner() {
    if (directHtml5Qrcode && directHtml5Qrcode.isScanning) {
        directHtml5Qrcode.stop().then(() => {
            document.getElementById('dropReader').style.display = 'none';
            document.getElementById('scannerTrigger').style.display = 'flex';
        }).catch(err => console.log(err));
    }
}

function connectDropManual(scannedCode = null) {
    if(navigator.vibrate) navigator.vibrate(15);
    
    const code = scannedCode || document.getElementById('manualDropCode').value.trim();
    
    if(!code || code.length !== 8) return alert("Please enter the full 8-digit secure PIN!");
    
    showDropStatus("VERIFYING... ⏳", "var(--text)", "radar", 0, false);
    
    dropConn = dropPeer.connect(code);
    
    dropConn.on('open', () => {
        if(navigator.vibrate) navigator.vibrate(30);
        document.getElementById('senderInitialUI').style.display = 'none';
        document.getElementById('dropSendSection').style.display = 'block';
        showDropStatus("CONNECTION SECURED! 🔗", "#28a745", "none", 0, true);
    });
    
    dropConn.on('data', (data) => {
        if (data.type === 'ack' && resolveCurrentFile) resolveCurrentFile(); 
    });

    dropConn.on('error', () => { showDropStatus("INVALID PIN OR EXPIRED ❌", "var(--accent)", "none", 0, true); });
    dropConn.on('close', () => { disconnectDrop(true); });
}

function updateDropFileLabel() {
    const fileInput = document.getElementById('dropFileInput');
    const label = document.getElementById('dropFileLabel');
    const icon = document.getElementById('dropFileIcon');
    
    if (fileInput.files.length > 0) {
        if (fileInput.files.length === 1) {
            let name = fileInput.files[0].name;
            if(name.length > 20) name = name.substring(0, 18) + "...";
            label.innerText = name;
        } else {
            label.innerText = `${fileInput.files.length} FILES SELECTED`;
        }
        label.style.color = "var(--text)";
        icon.className = "fa-solid fa-file-circle-check";
    } else {
        label.innerText = "SELECT FILES";
        label.style.color = "var(--text)";
        icon.className = "fa-solid fa-file-circle-plus";
    }
}

// ✨ UPDATED: sendDropData (Handles both Text & Files)
async function sendDropData() {
    const fileInput = document.getElementById('dropFileInput');
    const textInput = document.getElementById('dropTextInput');
    
    const files = fileInput.files;
    const textData = textInput.value.trim();

    if(files.length === 0 && textData === "") return alert("Please enter text or select a file to send!");
    
    const btn = document.getElementById('dropSendBtn');
    btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> SENDING...`; 
    btn.disabled = true;

    // Send TEXT first if available
    if (textData !== "") {
        dropConn.send({ type: 'text', content: textData });
        textInput.value = ""; // clear text box
    }

    // Send FILES if available
    if (files.length > 0) {
        const CHUNK_SIZE = 1024 * 1024; 
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            dropConn.send({ type: 'header', filename: file.name, filetype: file.type, size: file.size });

            let offset = 0; let chunkCount = 0;
            
            while (offset < file.size) {
                if (dropConn.dataChannel.bufferedAmount > 8388608) await new Promise(r => setTimeout(r, 0));

                const slice = file.slice(offset, offset + CHUNK_SIZE);
                const buffer = await slice.arrayBuffer();
                dropConn.send({ type: 'chunk', data: buffer });
                
                offset += buffer.byteLength; chunkCount++;

                if (offset === file.size || chunkCount % 4 === 0) {
                    let percent = Math.round((offset / file.size) * 100);
                    showDropStatus(`SENDING: ${percent}%`, "var(--text)", "progress", percent, false);
                }
            }
            await new Promise(resolve => { resolveCurrentFile = resolve; });
        }
        fileInput.value = ""; 
        updateDropFileLabel(); 
    }
    
    if(navigator.vibrate) navigator.vibrate([20, 20]);
    // Passing true at the end will trigger auto-hide in 3 seconds!
    showDropStatus(`ALL DATA SENT! ✅`, "#28a745", "none", 0, true); 
    
    btn.innerHTML = `<i class="fa-solid fa-paper-plane"></i> SEND DATA`; 
    btn.disabled = false;
}

function disconnectDrop(auto = false) {
    if(dropConn) { dropConn.close(); dropConn = null; }
    stopDirectScanner(); 
    
    // Clear old text logs
    document.getElementById('dropTextLogs').innerHTML = "";
    document.getElementById('dropTextInput').value = "";

    document.getElementById('recvInitialUI').style.display = 'block';
    document.getElementById('recvConnectedUI').style.display = 'none';
    document.getElementById('senderInitialUI').style.display = 'block';
    document.getElementById('dropSendSection').style.display = 'none';
    document.getElementById('manualDropCode').value = '';
    document.getElementById('dropFileInput').value = ""; 
    updateDropFileLabel();

    if(!auto) {
        if(navigator.vibrate) navigator.vibrate([20, 20, 20]);
        showDropStatus("SESSION DESTROYED 🔴", "var(--accent)", "none", 0, true);
    } else {
        document.getElementById('dropStatus').style.display = 'none';
    }
    initDropSystem(true);
}
</script>
</body>
</html>
